@startuml
!theme plain
skinparam defaultFontName "Roboto, sans-serif"
skinparam defaultFontColor #000000
skinparam titleFontSize 20
skinparam rectangle {
    roundCorner 8
    shadowing false
}

title Chromium + Android DRM æ¶æ„

package "ç”¨æˆ·ç©ºé—´ (User Space)" #LightBlue {
    rectangle "Chromium æµè§ˆå™¨" as Browser {
        rectangle "Blink æ¸²æŸ“å¼•æ“" as Blink
        rectangle "EME API" as EME <<Encrypted Media Extensions>>
    }

    rectangle "Android æ¡†æ¶" as Framework {
        rectangle "MediaDrm API" as MediaDrm
    }

    rectangle "Native å±‚" as Native {
        rectangle "JNI Bridge â†’ MediaDrm/DrmClient" as JNI
    }

}

package "ç¡¬ä»¶æŠ½è±¡ & å†…æ ¸" #LightGreen {
    rectangle "DRM HAL (Vendor å®ç°)" as VendorHAL
    rectangle "TEE é©±åŠ¨" as TeeDriver <<Kernel Driver>>
}

package "å®‰å…¨ä¸–ç•Œ (Secure World)" #LightCoral {
    rectangle "TEE OS (Trusty/QSEE)" as TeeOS
    rectangle "DRM Trusted App (TA)" as DrmTA
}

' --- è°ƒç”¨æµç¨‹ ---
Browser -down-> EME : JS è°ƒç”¨
EME -down-> MediaDrm : è¯·æ±‚ License / è§£å¯†
MediaDrm -down-> JNI : JNI è°ƒç”¨åŸç”Ÿ
JNI -down-> VendorHAL : HAL æ¥å£è°ƒç”¨
VendorHAL -down-> TeeDriver : ioctl è°ƒç”¨
TeeDriver -down-> TeeOS : SMC åˆ‡æ¢åˆ°å®‰å…¨ä¸–ç•Œ
TeeOS --> DrmTA : æ‰§è¡Œè§£å¯†æ“ä½œ / å¯†é’¥ç®¡ç†
DrmTA -down--> TeeOS : è¿”å›è§£å¯†ç»“æœ
TeeOS --> TeeDriver : è¿”å›
TeeDriver --> VendorHAL : è¿”å›
VendorHAL --> JNI : è¿”å›
JNI --> MediaDrm : è¿”å›
MediaDrm --> EME : è¿”å› License / è§£å¯†çŠ¶æ€
EME --> Browser : è§†é¢‘æ’­æ”¾

' ' --- å®‰å…¨è¯´æ˜ ---
' note right of DrmTA
'   ğŸ”’ L1 DRM: å¯†é’¥æ°¸è¿œä¸ç¦»å¼€ TEE TA
'   ğŸ”“ L3 DRM: ä»…è½¯ä»¶è§£å¯†ï¼Œå¯†é’¥åœ¨ç”¨æˆ·ç©ºé—´
' end note

' note left of Browser
'   âš ï¸ è‡ªç ”æµè§ˆå™¨å¿…é¡»è°ƒç”¨ç³»ç»Ÿ Widevine CDM
'   å¦åˆ™æ— æ³•æ’­æ”¾ Netflix L1 å†…å®¹
' end note

@enduml
