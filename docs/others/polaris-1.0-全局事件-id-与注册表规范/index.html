<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ethen 的实验室</title><meta name=keywords content><meta name=description content="Polaris 1.0 全局事件 ID 与注册表规范
Global Event ID & Registry Specification
版本历史

  
      
          文档版本
          修改日期
          修改人
          说明
      
  
  
      
          V1.0
          2025-12-XX
          [xxx名字]
          初始发布
      
  

概述
为了支撑 Polaris 1.0 实现“端云一体”的性能与稳定性监控，解决跨 SoC（Android/Linux）与 MCU 的异构数据治理难题，并适配车云 SDK 的接口限制，本项目采用 “注册制 + 扁平化 ID” 的管理模式。
核心原则：

ID 去语义化：EventID 仅作为唯一索引（Key），不再承载复杂的业务含义。
定义元数据化：所有的业务属性（模块、等级、日志策略）统一在《全局注册表》中维护。
文档即代码：注册表是唯一可信来源，模版代码以及常量由注册表自动生成。

事件 ID 编码规范
Polaris 事件 ID 采用 10 位纯数字 格式，分为三个物理段。
ID 结构公式
[Prefix (3位)] + [Scope (1位)] + [Sequence (6位)]
字段定义

  
      
          字段
          位数
          说明
          取值定义
      
  
  
      
          Prefix
          3
          物理系统归属 (硬性约束）
          666: Android 系统; 668: Linux Host 系统; 685: MCU 子系统
      
      
          Scope
          1
          管理域 (ID 分配权隔离）
          0: 平台/系统维护; 1: 业务/应用维护
      
      
          Sequence
          6
          流水号 (全局唯一）
          000001 ~ 999999 按申请顺序递增，不分类，不回退。
      
  

全局事件注册表模版
本注册表建议使用 Git 托管的 CSV 文件 或 在线协作表格 维护。它是生成 SDK 代码的唯一依据。"><meta name=author content><link rel=canonical href=https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6-id-%E4%B8%8E%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%A7%84%E8%8C%83/><link crossorigin=anonymous href=/ethenslab/assets/css/stylesheet.a1917769c3c78460b110da6d7905321bb53af4a56f22ba4cc0de824cf4d097ab.css integrity="sha256-oZF3acPHhGCxENpteQUyG7U69KVvIrpMwN6CTPTQl6s=" rel="preload stylesheet" as=style><link rel=icon href=https://ethen-cao.github.io/ethenslab/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ethen-cao.github.io/ethenslab/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ethen-cao.github.io/ethenslab/favicon-32x32.png><link rel=apple-touch-icon href=https://ethen-cao.github.io/ethenslab/apple-touch-icon.png><link rel=mask-icon href=https://ethen-cao.github.io/ethenslab/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6-id-%E4%B8%8E%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%A7%84%E8%8C%83/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6-id-%E4%B8%8E%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%A7%84%E8%8C%83/"><meta property="og:site_name" content="Ethen 的实验室"><meta property="og:title" content="Ethen 的实验室"><meta property="og:description" content="Polaris 1.0 全局事件 ID 与注册表规范 Global Event ID & Registry Specification
版本历史 文档版本 修改日期 修改人 说明 V1.0 2025-12-XX [xxx名字] 初始发布 概述 为了支撑 Polaris 1.0 实现“端云一体”的性能与稳定性监控，解决跨 SoC（Android/Linux）与 MCU 的异构数据治理难题，并适配车云 SDK 的接口限制，本项目采用 “注册制 + 扁平化 ID” 的管理模式。
核心原则：
ID 去语义化：EventID 仅作为唯一索引（Key），不再承载复杂的业务含义。 定义元数据化：所有的业务属性（模块、等级、日志策略）统一在《全局注册表》中维护。 文档即代码：注册表是唯一可信来源，模版代码以及常量由注册表自动生成。 事件 ID 编码规范 Polaris 事件 ID 采用 10 位纯数字 格式，分为三个物理段。
ID 结构公式 [Prefix (3位)] + [Scope (1位)] + [Sequence (6位)]
字段定义 字段 位数 说明 取值定义 Prefix 3 物理系统归属 (硬性约束） 666: Android 系统; 668: Linux Host 系统; 685: MCU 子系统 Scope 1 管理域 (ID 分配权隔离） 0: 平台/系统维护; 1: 业务/应用维护 Sequence 6 流水号 (全局唯一） 000001 ~ 999999 按申请顺序递增，不分类，不回退。 全局事件注册表模版 本注册表建议使用 Git 托管的 CSV 文件 或 在线协作表格 维护。它是生成 SDK 代码的唯一依据。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="others"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Polaris 1.0 全局事件 ID 与注册表规范
Global Event ID & Registry Specification
版本历史

  
      
          文档版本
          修改日期
          修改人
          说明
      
  
  
      
          V1.0
          2025-12-XX
          [xxx名字]
          初始发布
      
  

概述
为了支撑 Polaris 1.0 实现“端云一体”的性能与稳定性监控，解决跨 SoC（Android/Linux）与 MCU 的异构数据治理难题，并适配车云 SDK 的接口限制，本项目采用 “注册制 + 扁平化 ID” 的管理模式。
核心原则：

ID 去语义化：EventID 仅作为唯一索引（Key），不再承载复杂的业务含义。
定义元数据化：所有的业务属性（模块、等级、日志策略）统一在《全局注册表》中维护。
文档即代码：注册表是唯一可信来源，模版代码以及常量由注册表自动生成。

事件 ID 编码规范
Polaris 事件 ID 采用 10 位纯数字 格式，分为三个物理段。
ID 结构公式
[Prefix (3位)] + [Scope (1位)] + [Sequence (6位)]
字段定义

  
      
          字段
          位数
          说明
          取值定义
      
  
  
      
          Prefix
          3
          物理系统归属 (硬性约束）
          666: Android 系统; 668: Linux Host 系统; 685: MCU 子系统
      
      
          Scope
          1
          管理域 (ID 分配权隔离）
          0: 平台/系统维护; 1: 业务/应用维护
      
      
          Sequence
          6
          流水号 (全局唯一）
          000001 ~ 999999 按申请顺序递增，不分类，不回退。
      
  

全局事件注册表模版
本注册表建议使用 Git 托管的 CSV 文件 或 在线协作表格 维护。它是生成 SDK 代码的唯一依据。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"杂记","item":"https://ethen-cao.github.io/ethenslab/others/"},{"@type":"ListItem","position":2,"name":"","item":"https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6-id-%E4%B8%8E%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%A7%84%E8%8C%83/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","name":"","description":"Polaris 1.0 全局事件 ID 与注册表规范 Global Event ID \u0026amp; Registry Specification\n版本历史 文档版本 修改日期 修改人 说明 V1.0 2025-12-XX [xxx名字] 初始发布 概述 为了支撑 Polaris 1.0 实现“端云一体”的性能与稳定性监控，解决跨 SoC（Android/Linux）与 MCU 的异构数据治理难题，并适配车云 SDK 的接口限制，本项目采用 “注册制 + 扁平化 ID” 的管理模式。\n核心原则：\nID 去语义化：EventID 仅作为唯一索引（Key），不再承载复杂的业务含义。 定义元数据化：所有的业务属性（模块、等级、日志策略）统一在《全局注册表》中维护。 文档即代码：注册表是唯一可信来源，模版代码以及常量由注册表自动生成。 事件 ID 编码规范 Polaris 事件 ID 采用 10 位纯数字 格式，分为三个物理段。\nID 结构公式 [Prefix (3位)] + [Scope (1位)] + [Sequence (6位)]\n字段定义 字段 位数 说明 取值定义 Prefix 3 物理系统归属 (硬性约束） 666: Android 系统; 668: Linux Host 系统; 685: MCU 子系统 Scope 1 管理域 (ID 分配权隔离） 0: 平台/系统维护; 1: 业务/应用维护 Sequence 6 流水号 (全局唯一） 000001 ~ 999999 按申请顺序递增，不分类，不回退。 全局事件注册表模版 本注册表建议使用 Git 托管的 CSV 文件 或 在线协作表格 维护。它是生成 SDK 代码的唯一依据。\n","keywords":[],"articleBody":"Polaris 1.0 全局事件 ID 与注册表规范 Global Event ID \u0026 Registry Specification\n版本历史 文档版本 修改日期 修改人 说明 V1.0 2025-12-XX [xxx名字] 初始发布 概述 为了支撑 Polaris 1.0 实现“端云一体”的性能与稳定性监控，解决跨 SoC（Android/Linux）与 MCU 的异构数据治理难题，并适配车云 SDK 的接口限制，本项目采用 “注册制 + 扁平化 ID” 的管理模式。\n核心原则：\nID 去语义化：EventID 仅作为唯一索引（Key），不再承载复杂的业务含义。 定义元数据化：所有的业务属性（模块、等级、日志策略）统一在《全局注册表》中维护。 文档即代码：注册表是唯一可信来源，模版代码以及常量由注册表自动生成。 事件 ID 编码规范 Polaris 事件 ID 采用 10 位纯数字 格式，分为三个物理段。\nID 结构公式 [Prefix (3位)] + [Scope (1位)] + [Sequence (6位)]\n字段定义 字段 位数 说明 取值定义 Prefix 3 物理系统归属 (硬性约束） 666: Android 系统; 668: Linux Host 系统; 685: MCU 子系统 Scope 1 管理域 (ID 分配权隔离） 0: 平台/系统维护; 1: 业务/应用维护 Sequence 6 流水号 (全局唯一） 000001 ~ 999999 按申请顺序递增，不分类，不回退。 全局事件注册表模版 本注册表建议使用 Git 托管的 CSV 文件 或 在线协作表格 维护。它是生成 SDK 代码的唯一依据。\n核心字段定义 分类 列名 说明 示例 Identity EventID 10位唯一码 6660000001 EventName 代码常量名 GVM_SYS_FW_RESET Logic Logical_Module 逻辑归属模块 (用于云端分类) Framework, Audio, Map Owner 责任团队 (用于自动派单) System-Team, BSP-Team SDK SDK_Type 映射车云 SDK type (1=Info, 2=Exc, 3=Err) 3 SDK_Level 映射车云 SDK elevel (0=Biz, 1=Sys) 1 Policy Log_Source_Path 大文件源路径目录 (不含文件名)\n用于云端拉取时拼接 Base Path /log/perflog/anr/; /log/perflog/tombstones/ Desc_Schema 业务专属字段定义\n格式：key:type (支持 int, long, string, float, bool) reason:string Meta Status 状态: Active, Deprecated Active Trigger_Condition QA 测试验收标准 (文档用) Main thread blocked \u003e 60s 注意： Desc_Schema 仅定义业务特有的字段。以下 5 个 Common 字段 为系统保留字段，由 SDK 自动注入或通过专用接口设置，严禁出现在 Desc_Schema 中：\n字段 类型 说明 来源/处理逻辑 tid string Trace ID。全链路追踪 ID。用于串联跨端/跨进程调用。 自动获取 pid int Process ID。定位具体进程实例。 自动获取 / 代上报时覆写 proc string Process Name。明确责任进程（如 com.map.app）。 自动获取 / 代上报时覆写 ver string Version。业务模块版本号（如 1.2.0）。 自动获取 / 代上报时覆写 logf string Log Filename。大文件文件名（不含路径）。 手动设置 (setLogRef)，默认为空 语法说明： Desc_Schema 支持可选参数标记 ?。\n示例：reason:string? 解释：表示除了系统自动注入的 tid, pid 等字段外，该事件还包含一个可选的业务字段 reason（即构造函数中不强制要求传入 reason）。 表格内容示例 EventID EventName Logical_Module Owner SDK_Type SDK_Level Log_Source_Path Desc_Schema (JSON Fields) Status Trigger_Condition 6660000001 GVM_SYS_FW_RESET Framework System Team 3 1 /data/anr/ reason:string Active SystemServer Watchdog 6660000002 GVM_APP_CRASH AppManager System Team 3 1 /data/tombstones/ signal:int; exception:string? Active Any Java/Native Crash 6660000003 GVM_APP_ANR AppManager System Team 2 1 /data/anr/ activity:string? Active Any App Main Thread Block 6661000099 GVM_MUSIC_LAUNCH_SLOW MusicApp Music Team 1 0 NONE dur:long; stage:string Active Cold Start \u003e 2000ms 6850000001 MCU_BATT_VOLT_LOW Power Team Power 1 1 NONE vol:float; current:float Active Vol \u003c 9V 注册表变更与 Schema 演进规则 为了保证端侧代码（Old Version）与云端解析（New Config）的兼容性，注册表变更必须遵循 “Copy-On-Write” (写时复制) 原则。\n规则 1：Schema 变更即新事件 如果一个已发布的 Active 事件需要修改 Desc_Schema（无论是删除字段、修改字段类型，还是增加必填字段），严禁直接修改原行。\n操作步骤： 将原 EventID 的状态标记为 Deprecated。 申请一个新的 EventID。 EventName 建议增加后缀 _V2, _V3 以示区分。 规则 2：非破坏性变更 仅修改 Owner、Trigger_Condition、Log_Source_Path、Status 等不影响代码编译和数据解析的字段，允许直接修改原行。\n规则 3：弃用流程 标记为 Deprecated 的事件：\n代码生成：生成的代码会添加 @Deprecated 注解，提示开发者迁移。 运行时：Polaris Agent 依然允许上报该 ID，保证旧版本车机的兼容性。 云端：云端应将此类数据标记为“遗留数据”。 6. 常量命名规范 (Naming Convention) 为了保证代码可读性，注册表中的 EventName 必须遵循以下命名标准。\nSCOPE_MODULE_[LAYER/OBJECT]_CONDITION\n字段 必填 说明 示例 SCOPE ✅ 物理/虚拟域，界定事件发生的系统边界。 GVM, PVM, MCU MODULE ✅ 业务模块，界定事件所属的功能集合。 AUDIO, MAP, POWER LAYER / OBJECT ⚪ 层级或对象，进一步细化定位。 FW, HAL, SRV, ACT CONDITION ✅ 状态/结果，标准化的后缀 CRASH, TIMEOUT, ANR CONDITION (必须使用标准后缀): 致命异常类 后缀 含义 WBS 对应场景 示例 EventName _CRASH 进程崩溃/退出 Top Crash 榜单、核心进程 Crash GVM_APP_MAP_CRASH; GVM_SYS_SURFACE_CRASH _ANR 应用无响应 Top ANR 榜单 GVM_APP_MUSIC_ANR _RESET 系统/服务复位 SystemServer 重启、系统重启 GVM_SYS_FW_RESET; PVM_HOST_OS_RESET _OOM 内存溢出 (Java) 应用 OOM 事件 GVM_APP_MAP_OOM _KILLED 被强制杀死 LMK 杀进程、资源枯竭导致被杀 GVM_APP_TIKTOK_KILLED; GVM_SYS_PROC_LMK_KILLED _BLANK 黑屏/无显示 行驶中黑屏 (安全) GVM_DISP_SCREEN_BLANK 性能与体验类 后缀 含义 WBS 对应场景 示例 EventName _SLOW 速度慢/耗时久 Activity 启动速度 GVM_APP_MAP_LAUNCH_SLOW _BLOCK 线程阻塞 主线程拥堵 (未达ANR但超过阈值) GVM_APP_UI_THREAD_BLOCK _JANK 掉帧/卡顿 界面掉帧监控 GVM_APP_LIST_SCROLL_JANK _TIMEOUT 通信/等待超时 Binder 异常通信 GVM_SYS_BINDER_TX_TIMEOUT _BUSY 繁忙/缓冲区满 Binder 缓冲区满、CPU 满载 GVM_SYS_BINDER_BUSY 资源泄漏与越限类 后缀 含义 WBS 对应场景 示例 EventName _LEAK 资源泄漏 文件句柄(FD)泄漏 GVM_APP_MAP_FD_LEAK _HIGH 占用过高 CPU/内存趋势过高 GVM_SYS_CPU_LOAD_HIGH; GVM_APP_MEM_USAGE_HIGH _LOW 资源不足 磁盘空间不足 GVM_SYS_STORAGE_LOW 链路与管控类 后缀 含义 WBS 对应场景 示例 EventName _LOST 连接丢失/断链 仪表通信丢失 MCU_IC_CONN_LOST _REJECT 策略拒绝 遥测命令白名单拦截、行车态禁止 GVM_RMT_CMD_REJECT _FAIL 执行失败 遥测命令执行出错 GVM_RMT_CMD_EXEC_FAIL 注意：代码生成器必须对上述 14 个后缀进行 Whitelist 校验，严禁使用非标准后缀。\n7. 注册表管理与自动化流程 严禁开发人员手动修改代码中的 ID 常量，必须遵循以下流程：\n7.1 维护流程 申请：开发人员在《注册表》中新增一行，申请新的 ID (使用 MAX_ID + 1)。 评审：Polaris项目组评审 EventName 是否规范、SDK_Type 是否准确。 提交：将更新后的 CSV/Excel 提交至 polaris-protocol Git 仓库。 生成：CI 流水线自动触发 polaris-codegen 脚本。 8. 车云 SDK 接口定义 public native int sendWcLog(long evid, byte etype, short elevel, long eTime, String edesc); 8.1 功能描述 向车云 Native 进程发送维测流日志，车云 Native 进程最终负责将这些事件上传云端。\n8.2 参数说明 参数名 类型 描述 备注 evid long 事件 ID 必填 etype byte 事件类型 必填 elevel short 事件等级 必填 eTime long 事件时间戳（毫秒） 必填 edesc String 事件描述信息 (JSON) 必填; 限制 1000 字节 8.3 edesc 字段组成 edesc 是一个 JSON 字符串，由 Common 字段 和 Desc_Schema 字段 组合而成。\n字段 类型 字节估算 说明 tid string ~32 bytes Trace ID。全链路追踪 ID。用于串联跨端/跨进程调用。 pid int ~4 bytes Process ID。结合 logcat/tombstone 时定位具体进程实例。 proc string ~20 bytes Process Name。明确是谁出的事（如 com.map.app）。 ver string ~10 bytes Version。应用/模块自身的版本号（如 1.2.0）。 logf string ~20 bytes Log Filename。大文件文件名（不含路径）；默认为空，手动设置。 … … … 注册表 Desc_Schema 中定义的其他业务字段。 ","wordCount":"673","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6-id-%E4%B8%8E%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%A7%84%E8%8C%83/"},"publisher":{"@type":"Organization","name":"Ethen 的实验室","logo":{"@type":"ImageObject","url":"https://ethen-cao.github.io/ethenslab/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ethen-cao.github.io/ethenslab/ accesskey=h title="Ethen 的实验室 (Alt + H)">Ethen 的实验室</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ethen-cao.github.io/ethenslab/android-dev/ title=Android系统开发><span>Android系统开发</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/android-automotive-os-dev/ title="Android Automotive"><span>Android Automotive</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/qnx/ title=QNX开发><span>QNX开发</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/gunyah/ title=Gunyah><span>Gunyah</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/ivi-solution/ title=智能座舱方案><span>智能座舱方案</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/explore-ai title="Explore AI"><span>Explore AI</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ethen-cao.github.io/ethenslab/>Home</a>&nbsp;»&nbsp;<a href=https://ethen-cao.github.io/ethenslab/others/>杂记</a></div><h1 class="post-title entry-hint-parent"></h1><div class=post-meta>4 min&nbsp;·&nbsp;673 words</div></header><div class=post-content><h1 id=polaris-10-全局事件-id-与注册表规范>Polaris 1.0 全局事件 ID 与注册表规范<a hidden class=anchor aria-hidden=true href=#polaris-10-全局事件-id-与注册表规范>#</a></h1><p><strong>Global Event ID & Registry Specification</strong></p><h2 id=版本历史>版本历史<a hidden class=anchor aria-hidden=true href=#版本历史>#</a></h2><table><thead><tr><th>文档版本</th><th>修改日期</th><th>修改人</th><th>说明</th></tr></thead><tbody><tr><td>V1.0</td><td>2025-12-XX</td><td>[xxx名字]</td><td>初始发布</td></tr></tbody></table><h2 id=概述>概述<a hidden class=anchor aria-hidden=true href=#概述>#</a></h2><p>为了支撑 Polaris 1.0 实现“端云一体”的性能与稳定性监控，解决跨 SoC（Android/Linux）与 MCU 的异构数据治理难题，并适配车云 SDK 的接口限制，本项目采用 <strong>“注册制 + 扁平化 ID”</strong> 的管理模式。</p><p><strong>核心原则：</strong></p><ol><li><strong>ID 去语义化</strong>：EventID 仅作为唯一索引（Key），不再承载复杂的业务含义。</li><li><strong>定义元数据化</strong>：所有的业务属性（模块、等级、日志策略）统一在《全局注册表》中维护。</li><li><strong>文档即代码</strong>：注册表是唯一可信来源，模版代码以及常量由注册表自动生成。</li></ol><h2 id=事件-id-编码规范>事件 ID 编码规范<a hidden class=anchor aria-hidden=true href=#事件-id-编码规范>#</a></h2><p>Polaris 事件 ID 采用 <strong>10 位纯数字</strong> 格式，分为三个物理段。</p><h3 id=id-结构公式>ID 结构公式<a hidden class=anchor aria-hidden=true href=#id-结构公式>#</a></h3><p><code>[Prefix (3位)]</code> + <code>[Scope (1位)]</code> + <code>[Sequence (6位)]</code></p><h3 id=字段定义>字段定义<a hidden class=anchor aria-hidden=true href=#字段定义>#</a></h3><table><thead><tr><th>字段</th><th>位数</th><th>说明</th><th>取值定义</th></tr></thead><tbody><tr><td>Prefix</td><td>3</td><td>物理系统归属 (硬性约束）</td><td>666: Android 系统; 668: Linux Host 系统; 685: MCU 子系统</td></tr><tr><td>Scope</td><td>1</td><td>管理域 (ID 分配权隔离）</td><td>0: 平台/系统维护; 1: 业务/应用维护</td></tr><tr><td>Sequence</td><td>6</td><td>流水号 (全局唯一）</td><td>000001 ~ 999999 按申请顺序递增，不分类，不回退。</td></tr></tbody></table><h2 id=全局事件注册表模版>全局事件注册表模版<a hidden class=anchor aria-hidden=true href=#全局事件注册表模版>#</a></h2><p>本注册表建议使用 <strong>Git 托管的 CSV 文件</strong> 或 <strong>在线协作表格</strong> 维护。它是生成 SDK 代码的唯一依据。</p><h3 id=核心字段定义>核心字段定义<a hidden class=anchor aria-hidden=true href=#核心字段定义>#</a></h3><table><thead><tr><th>分类</th><th>列名</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>Identity</td><td>EventID</td><td>10位唯一码</td><td><code>6660000001</code></td></tr><tr><td></td><td>EventName</td><td>代码常量名</td><td><code>GVM_SYS_FW_RESET</code></td></tr><tr><td>Logic</td><td>Logical_Module</td><td>逻辑归属模块 (用于云端分类)</td><td><code>Framework</code>, <code>Audio</code>, <code>Map</code></td></tr><tr><td></td><td>Owner</td><td>责任团队 (用于自动派单)</td><td><code>System-Team</code>, <code>BSP-Team</code></td></tr><tr><td>SDK</td><td>SDK_Type</td><td>映射车云 SDK type (1=Info, 2=Exc, 3=Err)</td><td><code>3</code></td></tr><tr><td></td><td>SDK_Level</td><td>映射车云 SDK elevel (0=Biz, 1=Sys)</td><td><code>1</code></td></tr><tr><td>Policy</td><td>Log_Source_Path</td><td>大文件源路径目录 (不含文件名)<br>用于云端拉取时拼接 Base Path</td><td><code>/log/perflog/anr/</code>; <code>/log/perflog/tombstones/</code></td></tr><tr><td></td><td>Desc_Schema</td><td>业务专属字段定义<br>格式：<code>key:type</code> (支持 int, long, string, float, bool)</td><td><code>reason:string</code></td></tr><tr><td>Meta</td><td>Status</td><td>状态: <code>Active</code>, <code>Deprecated</code></td><td><code>Active</code></td></tr><tr><td></td><td>Trigger_Condition</td><td>QA 测试验收标准 (文档用)</td><td><code>Main thread blocked > 60s</code></td></tr></tbody></table><blockquote><p><strong>注意：</strong> <code>Desc_Schema</code> 仅定义业务特有的字段。以下 <strong>5 个 Common 字段</strong> 为系统保留字段，由 SDK 自动注入或通过专用接口设置，<strong>严禁</strong>出现在 <code>Desc_Schema</code> 中：</p></blockquote><table><thead><tr><th>字段</th><th>类型</th><th>说明</th><th>来源/处理逻辑</th></tr></thead><tbody><tr><td><strong>tid</strong></td><td>string</td><td><strong>Trace ID</strong>。全链路追踪 ID。用于串联跨端/跨进程调用。</td><td>自动获取</td></tr><tr><td><strong>pid</strong></td><td>int</td><td><strong>Process ID</strong>。定位具体进程实例。</td><td>自动获取 / 代上报时覆写</td></tr><tr><td><strong>proc</strong></td><td>string</td><td><strong>Process Name</strong>。明确责任进程（如 <code>com.map.app</code>）。</td><td>自动获取 / 代上报时覆写</td></tr><tr><td><strong>ver</strong></td><td>string</td><td><strong>Version</strong>。业务模块版本号（如 <code>1.2.0</code>）。</td><td>自动获取 / 代上报时覆写</td></tr><tr><td><strong>logf</strong></td><td>string</td><td><strong>Log Filename</strong>。大文件文件名（不含路径）。</td><td>手动设置 (<code>setLogRef</code>)，默认为空</td></tr></tbody></table><p><strong>语法说明：</strong>
<code>Desc_Schema</code> 支持可选参数标记 <code>?</code>。</p><ul><li><strong>示例</strong>：<code>reason:string?</code></li><li><strong>解释</strong>：表示除了系统自动注入的 <code>tid</code>, <code>pid</code> 等字段外，该事件还包含一个<strong>可选</strong>的业务字段 <code>reason</code>（即构造函数中不强制要求传入 <code>reason</code>）。</li></ul><h3 id=表格内容示例>表格内容示例<a hidden class=anchor aria-hidden=true href=#表格内容示例>#</a></h3><table><thead><tr><th>EventID</th><th>EventName</th><th>Logical_Module</th><th>Owner</th><th>SDK_Type</th><th>SDK_Level</th><th>Log_Source_Path</th><th>Desc_Schema (JSON Fields)</th><th>Status</th><th>Trigger_Condition</th></tr></thead><tbody><tr><td><code>6660000001</code></td><td><code>GVM_SYS_FW_RESET</code></td><td>Framework</td><td>System Team</td><td>3</td><td>1</td><td><code>/data/anr/</code></td><td><code>reason:string</code></td><td>Active</td><td>SystemServer Watchdog</td></tr><tr><td><code>6660000002</code></td><td><code>GVM_APP_CRASH</code></td><td>AppManager</td><td>System Team</td><td>3</td><td>1</td><td><code>/data/tombstones/</code></td><td><code>signal:int; exception:string?</code></td><td>Active</td><td>Any Java/Native Crash</td></tr><tr><td><code>6660000003</code></td><td><code>GVM_APP_ANR</code></td><td>AppManager</td><td>System Team</td><td>2</td><td>1</td><td><code>/data/anr/</code></td><td><code>activity:string?</code></td><td>Active</td><td>Any App Main Thread Block</td></tr><tr><td><code>6661000099</code></td><td><code>GVM_MUSIC_LAUNCH_SLOW</code></td><td>MusicApp</td><td>Music Team</td><td>1</td><td>0</td><td><code>NONE</code></td><td><code>dur:long; stage:string</code></td><td>Active</td><td>Cold Start > 2000ms</td></tr><tr><td><code>6850000001</code></td><td><code>MCU_BATT_VOLT_LOW</code></td><td>Power Team</td><td>Power</td><td>1</td><td>1</td><td><code>NONE</code></td><td><code>vol:float; current:float</code></td><td>Active</td><td>Vol &lt; 9V</td></tr></tbody></table><h3 id=注册表变更与-schema-演进规则>注册表变更与 Schema 演进规则<a hidden class=anchor aria-hidden=true href=#注册表变更与-schema-演进规则>#</a></h3><p>为了保证端侧代码（Old Version）与云端解析（New Config）的兼容性，注册表变更必须遵循 &ldquo;Copy-On-Write&rdquo; (写时复制) 原则。</p><p><strong>规则 1：Schema 变更即新事件</strong>
如果一个已发布的 Active 事件需要修改 Desc_Schema（无论是删除字段、修改字段类型，还是增加必填字段），<strong>严禁直接修改原行</strong>。</p><ul><li>操作步骤：</li></ul><ol><li>将原 EventID 的状态标记为 Deprecated。</li><li>申请一个新的 EventID。</li><li>EventName 建议增加后缀 <code>_V2</code>, <code>_V3</code> 以示区分。</li></ol><p><strong>规则 2：非破坏性变更</strong>
仅修改 Owner、Trigger_Condition、Log_Source_Path、Status 等不影响代码编译和数据解析的字段，允许直接修改原行。</p><p><strong>规则 3：弃用流程</strong>
标记为 Deprecated 的事件：</p><ol><li>代码生成：生成的代码会添加 <code>@Deprecated</code> 注解，提示开发者迁移。</li><li>运行时：Polaris Agent 依然允许上报该 ID，保证旧版本车机的兼容性。</li><li>云端：云端应将此类数据标记为“遗留数据”。</li></ol><h2 id=6-常量命名规范-naming-convention>6. 常量命名规范 (Naming Convention)<a hidden class=anchor aria-hidden=true href=#6-常量命名规范-naming-convention>#</a></h2><p>为了保证代码可读性，注册表中的 <code>EventName</code> 必须遵循以下命名标准。</p><p><strong>SCOPE_MODULE_[LAYER/OBJECT]_CONDITION</strong></p><table><thead><tr><th>字段</th><th>必填</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>SCOPE</td><td>✅</td><td>物理/虚拟域，界定事件发生的系统边界。</td><td><code>GVM</code>, <code>PVM</code>, <code>MCU</code></td></tr><tr><td>MODULE</td><td>✅</td><td>业务模块，界定事件所属的功能集合。</td><td><code>AUDIO</code>, <code>MAP</code>, <code>POWER</code></td></tr><tr><td>LAYER / OBJECT</td><td>⚪</td><td>层级或对象，进一步细化定位。</td><td><code>FW</code>, <code>HAL</code>, <code>SRV</code>, <code>ACT</code></td></tr><tr><td>CONDITION</td><td>✅</td><td>状态/结果，标准化的后缀</td><td><code>CRASH</code>, <code>TIMEOUT</code>, <code>ANR</code></td></tr></tbody></table><ul><li><strong>CONDITION (必须使用标准后缀)</strong>:</li></ul><ol><li><strong>致命异常类</strong></li></ol><table><thead><tr><th>后缀</th><th>含义</th><th>WBS 对应场景</th><th>示例 EventName</th></tr></thead><tbody><tr><td>_CRASH</td><td>进程崩溃/退出</td><td>Top Crash 榜单、核心进程 Crash</td><td><code>GVM_APP_MAP_CRASH</code>; <code>GVM_SYS_SURFACE_CRASH</code></td></tr><tr><td>_ANR</td><td>应用无响应</td><td>Top ANR 榜单</td><td><code>GVM_APP_MUSIC_ANR</code></td></tr><tr><td>_RESET</td><td>系统/服务复位</td><td>SystemServer 重启、系统重启</td><td><code>GVM_SYS_FW_RESET</code>; <code>PVM_HOST_OS_RESET</code></td></tr><tr><td>_OOM</td><td>内存溢出 (Java)</td><td>应用 OOM 事件</td><td><code>GVM_APP_MAP_OOM</code></td></tr><tr><td>_KILLED</td><td>被强制杀死</td><td>LMK 杀进程、资源枯竭导致被杀</td><td><code>GVM_APP_TIKTOK_KILLED</code>; <code>GVM_SYS_PROC_LMK_KILLED</code></td></tr><tr><td>_BLANK</td><td>黑屏/无显示</td><td>行驶中黑屏 (安全)</td><td><code>GVM_DISP_SCREEN_BLANK</code></td></tr></tbody></table><ol start=2><li><strong>性能与体验类</strong></li></ol><table><thead><tr><th>后缀</th><th>含义</th><th>WBS 对应场景</th><th>示例 EventName</th></tr></thead><tbody><tr><td>_SLOW</td><td>速度慢/耗时久</td><td>Activity 启动速度</td><td><code>GVM_APP_MAP_LAUNCH_SLOW</code></td></tr><tr><td>_BLOCK</td><td>线程阻塞</td><td>主线程拥堵 (未达ANR但超过阈值)</td><td><code>GVM_APP_UI_THREAD_BLOCK</code></td></tr><tr><td>_JANK</td><td>掉帧/卡顿</td><td>界面掉帧监控</td><td><code>GVM_APP_LIST_SCROLL_JANK</code></td></tr><tr><td>_TIMEOUT</td><td>通信/等待超时</td><td>Binder 异常通信</td><td><code>GVM_SYS_BINDER_TX_TIMEOUT</code></td></tr><tr><td>_BUSY</td><td>繁忙/缓冲区满</td><td>Binder 缓冲区满、CPU 满载</td><td><code>GVM_SYS_BINDER_BUSY</code></td></tr></tbody></table><ol start=3><li><strong>资源泄漏与越限类</strong></li></ol><table><thead><tr><th>后缀</th><th>含义</th><th>WBS 对应场景</th><th>示例 EventName</th></tr></thead><tbody><tr><td>_LEAK</td><td>资源泄漏</td><td>文件句柄(FD)泄漏</td><td><code>GVM_APP_MAP_FD_LEAK</code></td></tr><tr><td>_HIGH</td><td>占用过高</td><td>CPU/内存趋势过高</td><td><code>GVM_SYS_CPU_LOAD_HIGH</code>; <code>GVM_APP_MEM_USAGE_HIGH</code></td></tr><tr><td>_LOW</td><td>资源不足</td><td>磁盘空间不足</td><td><code>GVM_SYS_STORAGE_LOW</code></td></tr></tbody></table><ol start=4><li><strong>链路与管控类</strong></li></ol><table><thead><tr><th>后缀</th><th>含义</th><th>WBS 对应场景</th><th>示例 EventName</th></tr></thead><tbody><tr><td>_LOST</td><td>连接丢失/断链</td><td>仪表通信丢失</td><td><code>MCU_IC_CONN_LOST</code></td></tr><tr><td>_REJECT</td><td>策略拒绝</td><td>遥测命令白名单拦截、行车态禁止</td><td><code>GVM_RMT_CMD_REJECT</code></td></tr><tr><td>_FAIL</td><td>执行失败</td><td>遥测命令执行出错</td><td><code>GVM_RMT_CMD_EXEC_FAIL</code></td></tr></tbody></table><blockquote><p><strong>注意</strong>：代码生成器必须对上述 14 个后缀进行 <strong>Whitelist</strong> 校验，严禁使用非标准后缀。</p></blockquote><h2 id=7-注册表管理与自动化流程>7. 注册表管理与自动化流程<a hidden class=anchor aria-hidden=true href=#7-注册表管理与自动化流程>#</a></h2><p>严禁开发人员手动修改代码中的 ID 常量，必须遵循以下流程：</p><h3 id=71-维护流程>7.1 维护流程<a hidden class=anchor aria-hidden=true href=#71-维护流程>#</a></h3><ol><li><strong>申请</strong>：开发人员在《注册表》中新增一行，申请新的 ID (使用 <code>MAX_ID + 1</code>)。</li><li><strong>评审</strong>：Polaris项目组评审 <code>EventName</code> 是否规范、<code>SDK_Type</code> 是否准确。</li><li><strong>提交</strong>：将更新后的 CSV/Excel 提交至 <code>polaris-protocol</code> Git 仓库。</li><li><strong>生成</strong>：CI 流水线自动触发 <code>polaris-codegen</code> 脚本。</li></ol><h2 id=8-车云-sdk-接口定义>8. 车云 SDK 接口定义<a hidden class=anchor aria-hidden=true href=#8-车云-sdk-接口定义>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>native</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>sendWcLog</span>(<span style=color:#66d9ef>long</span> evid, <span style=color:#66d9ef>byte</span> etype, <span style=color:#66d9ef>short</span> elevel, <span style=color:#66d9ef>long</span> eTime, String edesc);
</span></span></code></pre></div><h3 id=81-功能描述>8.1 功能描述<a hidden class=anchor aria-hidden=true href=#81-功能描述>#</a></h3><p>向车云 Native 进程发送维测流日志，车云 Native 进程最终负责将这些事件上传云端。</p><h3 id=82-参数说明>8.2 参数说明<a hidden class=anchor aria-hidden=true href=#82-参数说明>#</a></h3><table><thead><tr><th>参数名</th><th>类型</th><th>描述</th><th>备注</th></tr></thead><tbody><tr><td>evid</td><td>long</td><td>事件 ID</td><td>必填</td></tr><tr><td>etype</td><td>byte</td><td>事件类型</td><td>必填</td></tr><tr><td>elevel</td><td>short</td><td>事件等级</td><td>必填</td></tr><tr><td>eTime</td><td>long</td><td>事件时间戳（毫秒）</td><td>必填</td></tr><tr><td>edesc</td><td>String</td><td>事件描述信息 (JSON)</td><td>必填; 限制 1000 字节</td></tr></tbody></table><h3 id=83-edesc-字段组成>8.3 edesc 字段组成<a hidden class=anchor aria-hidden=true href=#83-edesc-字段组成>#</a></h3><p><code>edesc</code> 是一个 JSON 字符串，由 <strong>Common 字段</strong> 和 <strong>Desc_Schema 字段</strong> 组合而成。</p><table><thead><tr><th>字段</th><th>类型</th><th>字节估算</th><th>说明</th></tr></thead><tbody><tr><td>tid</td><td>string</td><td>~32 bytes</td><td>Trace ID。全链路追踪 ID。用于串联跨端/跨进程调用。</td></tr><tr><td>pid</td><td>int</td><td>~4 bytes</td><td>Process ID。结合 logcat/tombstone 时定位具体进程实例。</td></tr><tr><td>proc</td><td>string</td><td>~20 bytes</td><td>Process Name。明确是谁出的事（如 <code>com.map.app</code>）。</td></tr><tr><td>ver</td><td>string</td><td>~10 bytes</td><td>Version。应用/模块自身的版本号（如 <code>1.2.0</code>）。</td></tr><tr><td>logf</td><td>string</td><td>~20 bytes</td><td>Log Filename。大文件文件名（不含路径）；默认为空，手动设置。</td></tr><tr><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td><td>注册表 <code>Desc_Schema</code> 中定义的其他业务字段。</td></tr></tbody></table></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://ethen-cao.github.io/ethenslab/>Ethen 的实验室</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0,theme:"default"})</script><script src=https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js></script><script>(function(){const e=document.querySelectorAll("pre > code.language-plantuml, pre > code.language-planuml");e.forEach(e=>{const s=e.innerText,o=plantumlEncoder.encode(s),i="https://www.plantuml.com/plantuml/svg/"+o,t=document.createElement("img");t.src=i,t.alt="PlantUML Diagram",t.style.maxWidth="100%";const n=e.parentNode;n.parentNode.replaceChild(t,n)})})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>