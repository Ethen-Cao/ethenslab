<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ethen çš„å®éªŒå®¤</title><meta name=keywords content><meta name=description content="Polaris 1.0 è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒè¦æ±‚
Polaris Code Generation Specification

  
      
          ç‰ˆæœ¬
          æ—¥æœŸ
          ä½œè€…
          è¯´æ˜
      
  
  
      
          v1.0
          2025-12-XX
          Polaris Team
          åˆå§‹ç‰ˆæœ¬
      
  


1. ç›®æ ‡ä¸åŸåˆ™ï¼ˆGoals & Principlesï¼‰
1.1 ç›®æ ‡
è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆï¼ˆCodegenï¼‰ç”¨äºå°† å…¨å±€äº‹ä»¶æ³¨å†Œè¡¨ è½¬æ¢ä¸ºï¼š

å¼ºç±»å‹ã€å¯ç¼–è¯‘æ ¡éªŒçš„ SDK ä»£ç 
è·¨è¯­è¨€ä¸€è‡´ï¼ˆJava / C++ï¼‰
å¯è¢« IDE ç²¾å‡†æç¤º
åœ¨å¤§è§„æ¨¡äº‹ä»¶æ•°é‡ä¸‹ä¾ç„¶å¯ç»´æŠ¤

1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼ˆå¼ºåˆ¶ï¼‰

  
      
          åŸåˆ™
          è¯´æ˜
      
  
  
      
          ç±»å‹å®‰å…¨ä¼˜å…ˆ
          ä»»ä½•å‚æ•°é”™è¯¯å¿…é¡»åœ¨ç¼–è¯‘æœŸæˆ–æ„é€ æœŸæš´éœ²
      
      
          å»ä¸­å¿ƒåŒ–
          ç¦æ­¢ç”Ÿæˆé›†ä¸­å¼ God Classï¼ˆå¦‚ Reporter èšåˆç±»ï¼‰
      
      
          ä¸€äº‹ä»¶ä¸€ç±»å‹
          æ¯ä¸ª Event å¿…é¡»ç”Ÿæˆç‹¬ç«‹çš„ Context ç±»
      
      
          æ„é€ å³åˆæ³•
          æ„é€ å‡½æ•°å¿…é¡»ä¿è¯å¿…å¡«å­—æ®µå®Œæ•´;å¯é€‰å­—æ®µæä¾›setteræ–¹æ³•
      
      
          ç”Ÿæˆä»£ç å¯åˆ å¯è£å‰ª
          æœªä½¿ç”¨äº‹ä»¶å…è®¸è¢« R8 / Linker ç§»é™¤
      
      
          Core ç¨³å®šï¼ŒGenerated æ˜“å˜
          Core SDK ä¸å› æ–°å¢äº‹ä»¶è€Œå˜åŒ–
      
  


2. è¾“å…¥æºè§„èŒƒï¼ˆSource of Truthï¼‰
2.1 å”¯ä¸€è¾“å…¥æº
è‡ªåŠ¨åŒ–ç”Ÿæˆçš„å”¯ä¸€å¯ä¿¡è¾“å…¥æºä¸ºï¼š"><meta name=author content><link rel=canonical href=https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E8%A7%84%E8%8C%83%E8%A6%81%E6%B1%82/><link crossorigin=anonymous href=/ethenslab/assets/css/stylesheet.a1917769c3c78460b110da6d7905321bb53af4a56f22ba4cc0de824cf4d097ab.css integrity="sha256-oZF3acPHhGCxENpteQUyG7U69KVvIrpMwN6CTPTQl6s=" rel="preload stylesheet" as=style><link rel=icon href=https://ethen-cao.github.io/ethenslab/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ethen-cao.github.io/ethenslab/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ethen-cao.github.io/ethenslab/favicon-32x32.png><link rel=apple-touch-icon href=https://ethen-cao.github.io/ethenslab/apple-touch-icon.png><link rel=mask-icon href=https://ethen-cao.github.io/ethenslab/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E8%A7%84%E8%8C%83%E8%A6%81%E6%B1%82/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E8%A7%84%E8%8C%83%E8%A6%81%E6%B1%82/"><meta property="og:site_name" content="Ethen çš„å®éªŒå®¤"><meta property="og:title" content="Ethen çš„å®éªŒå®¤"><meta property="og:description" content="Polaris 1.0 è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒè¦æ±‚ Polaris Code Generation Specification
ç‰ˆæœ¬ æ—¥æœŸ ä½œè€… è¯´æ˜ v1.0 2025-12-XX Polaris Team åˆå§‹ç‰ˆæœ¬ 1. ç›®æ ‡ä¸åŸåˆ™ï¼ˆGoals & Principlesï¼‰ 1.1 ç›®æ ‡ è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆï¼ˆCodegenï¼‰ç”¨äºå°† å…¨å±€äº‹ä»¶æ³¨å†Œè¡¨ è½¬æ¢ä¸ºï¼š
å¼ºç±»å‹ã€å¯ç¼–è¯‘æ ¡éªŒçš„ SDK ä»£ç  è·¨è¯­è¨€ä¸€è‡´ï¼ˆJava / C++ï¼‰ å¯è¢« IDE ç²¾å‡†æç¤º åœ¨å¤§è§„æ¨¡äº‹ä»¶æ•°é‡ä¸‹ä¾ç„¶å¯ç»´æŠ¤ 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼ˆå¼ºåˆ¶ï¼‰ åŸåˆ™ è¯´æ˜ ç±»å‹å®‰å…¨ä¼˜å…ˆ ä»»ä½•å‚æ•°é”™è¯¯å¿…é¡»åœ¨ç¼–è¯‘æœŸæˆ–æ„é€ æœŸæš´éœ² å»ä¸­å¿ƒåŒ– ç¦æ­¢ç”Ÿæˆé›†ä¸­å¼ God Classï¼ˆå¦‚ Reporter èšåˆç±»ï¼‰ ä¸€äº‹ä»¶ä¸€ç±»å‹ æ¯ä¸ª Event å¿…é¡»ç”Ÿæˆç‹¬ç«‹çš„ Context ç±» æ„é€ å³åˆæ³• æ„é€ å‡½æ•°å¿…é¡»ä¿è¯å¿…å¡«å­—æ®µå®Œæ•´;å¯é€‰å­—æ®µæä¾›setteræ–¹æ³• ç”Ÿæˆä»£ç å¯åˆ å¯è£å‰ª æœªä½¿ç”¨äº‹ä»¶å…è®¸è¢« R8 / Linker ç§»é™¤ Core ç¨³å®šï¼ŒGenerated æ˜“å˜ Core SDK ä¸å› æ–°å¢äº‹ä»¶è€Œå˜åŒ– 2. è¾“å…¥æºè§„èŒƒï¼ˆSource of Truthï¼‰ 2.1 å”¯ä¸€è¾“å…¥æº è‡ªåŠ¨åŒ–ç”Ÿæˆçš„å”¯ä¸€å¯ä¿¡è¾“å…¥æºä¸ºï¼š"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="others"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Polaris 1.0 è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒè¦æ±‚
Polaris Code Generation Specification

  
      
          ç‰ˆæœ¬
          æ—¥æœŸ
          ä½œè€…
          è¯´æ˜
      
  
  
      
          v1.0
          2025-12-XX
          Polaris Team
          åˆå§‹ç‰ˆæœ¬
      
  


1. ç›®æ ‡ä¸åŸåˆ™ï¼ˆGoals & Principlesï¼‰
1.1 ç›®æ ‡
è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆï¼ˆCodegenï¼‰ç”¨äºå°† å…¨å±€äº‹ä»¶æ³¨å†Œè¡¨ è½¬æ¢ä¸ºï¼š

å¼ºç±»å‹ã€å¯ç¼–è¯‘æ ¡éªŒçš„ SDK ä»£ç 
è·¨è¯­è¨€ä¸€è‡´ï¼ˆJava / C++ï¼‰
å¯è¢« IDE ç²¾å‡†æç¤º
åœ¨å¤§è§„æ¨¡äº‹ä»¶æ•°é‡ä¸‹ä¾ç„¶å¯ç»´æŠ¤

1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼ˆå¼ºåˆ¶ï¼‰

  
      
          åŸåˆ™
          è¯´æ˜
      
  
  
      
          ç±»å‹å®‰å…¨ä¼˜å…ˆ
          ä»»ä½•å‚æ•°é”™è¯¯å¿…é¡»åœ¨ç¼–è¯‘æœŸæˆ–æ„é€ æœŸæš´éœ²
      
      
          å»ä¸­å¿ƒåŒ–
          ç¦æ­¢ç”Ÿæˆé›†ä¸­å¼ God Classï¼ˆå¦‚ Reporter èšåˆç±»ï¼‰
      
      
          ä¸€äº‹ä»¶ä¸€ç±»å‹
          æ¯ä¸ª Event å¿…é¡»ç”Ÿæˆç‹¬ç«‹çš„ Context ç±»
      
      
          æ„é€ å³åˆæ³•
          æ„é€ å‡½æ•°å¿…é¡»ä¿è¯å¿…å¡«å­—æ®µå®Œæ•´;å¯é€‰å­—æ®µæä¾›setteræ–¹æ³•
      
      
          ç”Ÿæˆä»£ç å¯åˆ å¯è£å‰ª
          æœªä½¿ç”¨äº‹ä»¶å…è®¸è¢« R8 / Linker ç§»é™¤
      
      
          Core ç¨³å®šï¼ŒGenerated æ˜“å˜
          Core SDK ä¸å› æ–°å¢äº‹ä»¶è€Œå˜åŒ–
      
  


2. è¾“å…¥æºè§„èŒƒï¼ˆSource of Truthï¼‰
2.1 å”¯ä¸€è¾“å…¥æº
è‡ªåŠ¨åŒ–ç”Ÿæˆçš„å”¯ä¸€å¯ä¿¡è¾“å…¥æºä¸ºï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‚è®°","item":"https://ethen-cao.github.io/ethenslab/others/"},{"@type":"ListItem","position":2,"name":"","item":"https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E8%A7%84%E8%8C%83%E8%A6%81%E6%B1%82/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","name":"","description":"Polaris 1.0 è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒè¦æ±‚ Polaris Code Generation Specification\nç‰ˆæœ¬ æ—¥æœŸ ä½œè€… è¯´æ˜ v1.0 2025-12-XX Polaris Team åˆå§‹ç‰ˆæœ¬ 1. ç›®æ ‡ä¸åŸåˆ™ï¼ˆGoals \u0026amp; Principlesï¼‰ 1.1 ç›®æ ‡ è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆï¼ˆCodegenï¼‰ç”¨äºå°† å…¨å±€äº‹ä»¶æ³¨å†Œè¡¨ è½¬æ¢ä¸ºï¼š\nå¼ºç±»å‹ã€å¯ç¼–è¯‘æ ¡éªŒçš„ SDK ä»£ç  è·¨è¯­è¨€ä¸€è‡´ï¼ˆJava / C++ï¼‰ å¯è¢« IDE ç²¾å‡†æç¤º åœ¨å¤§è§„æ¨¡äº‹ä»¶æ•°é‡ä¸‹ä¾ç„¶å¯ç»´æŠ¤ 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼ˆå¼ºåˆ¶ï¼‰ åŸåˆ™ è¯´æ˜ ç±»å‹å®‰å…¨ä¼˜å…ˆ ä»»ä½•å‚æ•°é”™è¯¯å¿…é¡»åœ¨ç¼–è¯‘æœŸæˆ–æ„é€ æœŸæš´éœ² å»ä¸­å¿ƒåŒ– ç¦æ­¢ç”Ÿæˆé›†ä¸­å¼ God Classï¼ˆå¦‚ Reporter èšåˆç±»ï¼‰ ä¸€äº‹ä»¶ä¸€ç±»å‹ æ¯ä¸ª Event å¿…é¡»ç”Ÿæˆç‹¬ç«‹çš„ Context ç±» æ„é€ å³åˆæ³• æ„é€ å‡½æ•°å¿…é¡»ä¿è¯å¿…å¡«å­—æ®µå®Œæ•´;å¯é€‰å­—æ®µæä¾›setteræ–¹æ³• ç”Ÿæˆä»£ç å¯åˆ å¯è£å‰ª æœªä½¿ç”¨äº‹ä»¶å…è®¸è¢« R8 / Linker ç§»é™¤ Core ç¨³å®šï¼ŒGenerated æ˜“å˜ Core SDK ä¸å› æ–°å¢äº‹ä»¶è€Œå˜åŒ– 2. è¾“å…¥æºè§„èŒƒï¼ˆSource of Truthï¼‰ 2.1 å”¯ä¸€è¾“å…¥æº è‡ªåŠ¨åŒ–ç”Ÿæˆçš„å”¯ä¸€å¯ä¿¡è¾“å…¥æºä¸ºï¼š\n","keywords":[],"articleBody":"Polaris 1.0 è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒè¦æ±‚ Polaris Code Generation Specification\nç‰ˆæœ¬ æ—¥æœŸ ä½œè€… è¯´æ˜ v1.0 2025-12-XX Polaris Team åˆå§‹ç‰ˆæœ¬ 1. ç›®æ ‡ä¸åŸåˆ™ï¼ˆGoals \u0026 Principlesï¼‰ 1.1 ç›®æ ‡ è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆï¼ˆCodegenï¼‰ç”¨äºå°† å…¨å±€äº‹ä»¶æ³¨å†Œè¡¨ è½¬æ¢ä¸ºï¼š\nå¼ºç±»å‹ã€å¯ç¼–è¯‘æ ¡éªŒçš„ SDK ä»£ç  è·¨è¯­è¨€ä¸€è‡´ï¼ˆJava / C++ï¼‰ å¯è¢« IDE ç²¾å‡†æç¤º åœ¨å¤§è§„æ¨¡äº‹ä»¶æ•°é‡ä¸‹ä¾ç„¶å¯ç»´æŠ¤ 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼ˆå¼ºåˆ¶ï¼‰ åŸåˆ™ è¯´æ˜ ç±»å‹å®‰å…¨ä¼˜å…ˆ ä»»ä½•å‚æ•°é”™è¯¯å¿…é¡»åœ¨ç¼–è¯‘æœŸæˆ–æ„é€ æœŸæš´éœ² å»ä¸­å¿ƒåŒ– ç¦æ­¢ç”Ÿæˆé›†ä¸­å¼ God Classï¼ˆå¦‚ Reporter èšåˆç±»ï¼‰ ä¸€äº‹ä»¶ä¸€ç±»å‹ æ¯ä¸ª Event å¿…é¡»ç”Ÿæˆç‹¬ç«‹çš„ Context ç±» æ„é€ å³åˆæ³• æ„é€ å‡½æ•°å¿…é¡»ä¿è¯å¿…å¡«å­—æ®µå®Œæ•´;å¯é€‰å­—æ®µæä¾›setteræ–¹æ³• ç”Ÿæˆä»£ç å¯åˆ å¯è£å‰ª æœªä½¿ç”¨äº‹ä»¶å…è®¸è¢« R8 / Linker ç§»é™¤ Core ç¨³å®šï¼ŒGenerated æ˜“å˜ Core SDK ä¸å› æ–°å¢äº‹ä»¶è€Œå˜åŒ– 2. è¾“å…¥æºè§„èŒƒï¼ˆSource of Truthï¼‰ 2.1 å”¯ä¸€è¾“å…¥æº è‡ªåŠ¨åŒ–ç”Ÿæˆçš„å”¯ä¸€å¯ä¿¡è¾“å…¥æºä¸ºï¼š\nevents.csv / events.xlsxï¼ˆæ³¨å†Œè¡¨ï¼‰ ç¦æ­¢ä»ä»£ç åå‘ç”Ÿæˆæˆ–æ‰‹åŠ¨è¡¥ä¸ 2.2 å…³é”®å­—æ®µæ˜ å°„å…³ç³» æ³¨å†Œè¡¨å­—æ®µ ç”Ÿæˆä»£ç ä¸­çš„ç”¨é€” EventID Context æ„é€ å‡½æ•°ä¸­ç»‘å®š EventName ç±»å / å¸¸é‡å Desc_Schema å­—æ®µå®šä¹‰ã€æ„é€ å‡½æ•°å‚æ•° Status æ§åˆ¶æ˜¯å¦ç”Ÿæˆ / æ˜¯å¦æ ‡è®° Deprecated Logical_Module åŒ…å / namespace åˆ†ç»„ SDK_Type å¯¹åº”private final int SDK_TYPE SDK_LEVEL å¯¹åº”private final int SDK_LEVEL 3. ç”Ÿæˆç‰©æ€»ä½“ç»“æ„è§„èŒƒ 3.1 ç¦æ­¢ç”Ÿæˆçš„å†…å®¹ï¼ˆâŒ Hard Rulesï¼‰ Codegen è„šæœ¬å¿…é¡»éµå®ˆä»¥ä¸‹ç¦æ­¢é¡¹ï¼š\nâŒ ä¸å¾—ç”Ÿæˆï¼š\nPolarisReporter / EventManager ç­‰é›†ä¸­è°ƒåº¦ç±» report(long id, Object...) / Map é£æ ¼ API åå°„ã€å­—ç¬¦ä¸²æ‹¼å­—æ®µåçš„é€»è¾‘ å•æ–‡ä»¶åŒ…å«å¤šä¸ª Event çš„ Context ç±» 3.2 å¿…é¡»ç”Ÿæˆçš„å†…å®¹ï¼ˆâœ… Hard Rulesï¼‰ ç”Ÿæˆç‰© æ˜¯å¦å¿…é¡» è¯´æ˜ PolarisEvents âœ… EventID å¸¸é‡å®šä¹‰ BasePolarisContext âŒï¼ˆæ‰‹å†™ï¼‰ ä½äº Core SDK XxxContext âœ… æ¯ä¸ª Event ä¸€ä¸ª @Deprecated æ³¨è§£ âœ… Status=Deprecated æ ¸å¿ƒè§„åˆ™é€»è¾‘ Java åŒ…å: com.polaris.events.. Scope: å– EventName çš„ç¬¬ä¸€æ®µï¼ˆå¦‚ GVM -\u003e gvmï¼‰ã€‚ Logical_Module: å–æ³¨å†Œè¡¨ Logical_Module åˆ—ï¼Œè½¬å°å†™å¹¶å»ç©ºæ ¼ï¼ˆå¦‚ AppManager -\u003e appmanagerï¼‰ã€‚ C++ ç›®å½•: include/polaris/events/// ä¸ Java åŒ…åé€»è¾‘ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œç¡®ä¿è·¨è¯­è¨€ç»“æ„å¯¹ç§°ã€‚\nç±»åç”Ÿæˆ: EventName è½¬ PascalCase + Context GVM_APP_ANR -\u003e GvmAppAnrContext\né˜²å¾¡æ€§é€»è¾‘: è‡ªåŠ¨ä» Desc_Schema ä¸­å‰”é™¤ tid, pid, proc, ver, logfï¼Œé˜²æ­¢ä¸åŸºç±» Common å­—æ®µå†²çªã€‚ Java å¸¸é‡ä½¿ç”¨ static {} å—åˆå§‹åŒ–ï¼Œé˜²æ­¢ç¼–è¯‘å™¨å†…è”ã€‚\n4. Context ç±»ç”Ÿæˆè§„èŒƒï¼ˆæ ¸å¿ƒï¼‰ 4.1 ç±»å‘½åè§„åˆ™ + \"Context\" ç¤ºä¾‹ï¼š\nEventName Context ç±»å SYS_WATCHDOG_RESET SysWatchdogResetContext APP_MAP_ANR AppMapAnrContext 4.2 åŒ… / Namespace è§„åˆ™ï¼ˆå¼ºåˆ¶ï¼‰ com.polaris.events.. ç¤ºä¾‹ï¼š\ncom.polaris.events.framework.sys com.polaris.events.app.map com.polaris.events.mcu.power ğŸ“Œ Codegen å¿…é¡»æ”¯æŒæœªæ¥ æ‹†åˆ†ä¸ºç‹¬ç«‹ AAR / jar / so\n4.3 å­—æ®µä¸æ„é€ å‡½æ•°è§„åˆ™ï¼ˆå¼ºåˆ¶ï¼‰ 4.3.1 å¿…å¡«å­—æ®µï¼ˆRequiredï¼‰ å¿…é¡»ï¼š å‡ºç°åœ¨æ„é€ å‡½æ•°å‚æ•°åˆ—è¡¨ åœ¨æ„é€ å‡½æ•°å†…èµ‹å€¼ ç¦æ­¢ï¼š æä¾› setter æä¾›é»˜è®¤å€¼ Contextç±»å¿…é¡»æä¾›final int SDK_TYPEå’Œfinal int SDK_LEVELå­—æ®µï¼Œå˜é‡å€¼ä»events.csvä¸­æå–ï¼Œå¹¶æä¾›getæ–¹æ³• public SysWatchdogResetContext(int pid, String reason) { super(PolarisEvents.SYS_WATCHDOG_RESET); this.pid = pid; this.reason = reason; } 4.3.2 å¯é€‰å­—æ®µï¼ˆOptionalï¼‰ ä¸å‡ºç°åœ¨æ„é€ å‡½æ•°ä¸­ å¿…é¡»é€šè¿‡é“¾å¼ Setter è®¾ç½® Setter è¿”å› this public AppMapAnrContext setActivity(String activity) { this.activity = activity; return this; } 4.4 validate() ç”Ÿæˆè§„èŒƒ Codegen å¿…é¡»ç”Ÿæˆ validate() æ–¹æ³•ï¼Œè‡³å°‘åŒ…å«ï¼š\nRequired å­—æ®µéç©º / åˆæ³•æ€§æ ¡éªŒ æšä¸¾ / èŒƒå›´æ ¡éªŒï¼ˆå¦‚æœ‰ï¼‰ @Override public boolean validate() { return pid \u003e 0 \u0026\u0026 reason != null; } 4.5 report() ä¾¿æ·æ–¹æ³• ç”Ÿæˆç±» å¿…é¡»åŒ…å«ï¼š\npublic void report() { PolarisAgent.getInstance().report(this); } ğŸ“Œ è¯¥æ–¹æ³•ä»…æ˜¯è¯­æ³•ç³–ï¼Œä¸å¾—åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚\n4.6 å®ç° toJson() ä»¥åŠ toString() æ–¹æ³• 5. Deprecated äº‹ä»¶ç”Ÿæˆè§„åˆ™ å½“æ³¨å†Œè¡¨ä¸­ï¼š\nStatus = Deprecated Codegen å¿…é¡»ï¼š\nä»ç”Ÿæˆ Context ç±»ï¼ˆä¿è¯å…¼å®¹æ—§ä»£ç ï¼‰ æ·»åŠ  @Deprecated æ³¨è§£ Javadoc æ ‡æ˜æ›¿ä»£ EventIDï¼ˆå¦‚æœ‰ï¼‰ /** * @deprecated Use SYS_WATCHDOG_RESET_V2 instead */ @Deprecated public class SysWatchdogResetContext { ... } 6. PolarisEvents å¸¸é‡ç±»ç”Ÿæˆè§„èŒƒ 6.1 èŒè´£è¾¹ç•Œ åªå…è®¸åŒ…å« public static final long ä¸å…è®¸æ–¹æ³• ä¸å…è®¸é€»è¾‘ public final class PolarisEvents { public static final long SYS_WATCHDOG_RESET = 6660000001L; } 7. è·¨è¯­è¨€ä¸€è‡´æ€§è¦æ±‚ï¼ˆJava / C++ï¼‰ 7.1 ç”Ÿæˆè§„åˆ™å¿…é¡»ä¸€è‡´ ç»´åº¦ Java C++ ç±»/ç»“æ„ä½“ class struct / class æ„é€ å‡½æ•° å¼ºåˆ¶ Required å¼ºåˆ¶ Required Optional Setter Setter validate virtual override virtual override JSON JSONObject nlohmann::json 8. ç”Ÿæˆä»£ç è´¨é‡è¦æ±‚ 8.1 ç”Ÿæˆä»£ç å¿…é¡»æ»¡è¶³ å¯ç›´æ¥é€šè¿‡ javac / clang ç¼–è¯‘ æ—  warningï¼ˆ-Wallï¼‰ ä¸ä¾èµ–åå°„ ä¸ä¾èµ–è¿è¡Œæ—¶ schema 9. æ¼”è¿›ä¸å…¼å®¹æ€§è¦æ±‚ 9.1 Schema å˜æ›´è§„åˆ™ å˜æ›´ç±»å‹ æ˜¯å¦å…è®¸ æ–°å¢ Optional å­—æ®µ âŒï¼ˆéœ€æ–° EventIDï¼‰ ä¿®æ”¹å­—æ®µç±»å‹ âŒ ä¿®æ”¹ Required / Optional âŒ ä¿®æ”¹ Owner / Desc âœ… ğŸ“Œ Codegen å¿…é¡»å‡è®¾æ—§ç«¯ä»£ç æ°¸è¿œå­˜åœ¨\n10. éç›®æ ‡ï¼ˆNon-Goalsï¼‰ æœ¬è§„èŒƒ ä¸è´Ÿè´£ï¼š\näº‹ä»¶åˆ†é…æµç¨‹ æ³¨å†Œè¡¨è¯„å®¡æœºåˆ¶ äº‘ç«¯è§£æé€»è¾‘ SDK å‘é€ç­–ç•¥ 11. è®¾è®¡å“²å­¦ Codegen çš„èŒè´£ä¸æ˜¯â€œçœä»£ç â€ï¼Œ è€Œæ˜¯æŠŠâ€œé”™è¯¯â€å°½å¯èƒ½æå‰åˆ°ï¼š\nç¼–è¯‘æœŸ æ„é€ æœŸ IDE æç¤ºæœŸ å¦‚æœæŸä¸ªé”™è¯¯åªèƒ½åœ¨è¿è¡Œæ—¶å‘ç°ï¼Œ é‚£å°±æ˜¯ Codegen çš„å¤±è´¥ã€‚\n12. ç»“è¯­ è¿™å¥—è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒç¡®ä¿ï¼š\näº‹ä»¶è§„æ¨¡ Ã—1000ï¼Œå¤æ‚åº¦ â‰ˆ Ã—1 SDK ä½¿ç”¨ä½“éªŒé•¿æœŸç¨³å®š å¹³å°ä»£ç ä¸ä¸šåŠ¡äº‹ä»¶å½»åº•è§£è€¦ è¿™æ˜¯ä¸€ä¸ªâ€œä¸ºåå¹´ç»´æŠ¤å‘¨æœŸè€Œè®¾è®¡â€çš„ Codegen è§„èŒƒã€‚\né™„å½• javaä»£ç ç”Ÿæˆç›®å½•ç»“æ„ï¼Œå¯å‚è€ƒï¼š\ngenerated/ â””â”€â”€ java/ â””â”€â”€ com/polaris/ â”œâ”€â”€ constants/ â”‚ â””â”€â”€ PolarisEvents.java â”‚ â””â”€â”€ events/ â”œâ”€â”€ sys/ â”‚ â””â”€â”€ framework/ â”‚ â”œâ”€â”€ watchdog/ â”‚ â”‚ â””â”€â”€ SysWatchdogResetContext.java â”‚ â””â”€â”€ anr/ â”‚ â””â”€â”€ SysServiceAnrContext.java â”‚ â”œâ”€â”€ app/ â”‚ â””â”€â”€ map/ â”‚ â””â”€â”€ anr/ â”‚ â””â”€â”€ AppMapAnrContext.java â”‚ â””â”€â”€ mcu/ â””â”€â”€ power/ â””â”€â”€ battery/ â””â”€â”€ McuBatteryLowContext.java C++ä»£ç ç”Ÿæˆç›®å½•ç»“æ„ï¼Œå¯å‚è€ƒï¼š\ngenerated/ â””â”€â”€ cpp/ â”œâ”€â”€ include/ â”‚ â””â”€â”€ polaris/ â”‚ â”œâ”€â”€ constants/ â”‚ â”‚ â””â”€â”€ PolarisEvents.h â”‚ â”‚ â”‚ â””â”€â”€ events/ â”‚ â”œâ”€â”€ sys/ â”‚ â”‚ â””â”€â”€ framework/ â”‚ â”‚ â””â”€â”€ watchdog/ â”‚ â”‚ â””â”€â”€ SysWatchdogResetContext.h â”‚ â”‚ â”‚ â””â”€â”€ app/ â”‚ â””â”€â”€ map/ â”‚ â””â”€â”€ anr/ â”‚ â””â”€â”€ AppMapAnrContext.h â”‚ â””â”€â”€ src/ â””â”€â”€ events/ â””â”€â”€ ... å‚è€ƒä»£ç å®ç°ï¼š\nimport csv import os import sys from dataclasses import dataclass from typing import List, Set from jinja2 import Environment, BaseLoader # ========================================== # 1. å…¨å±€é…ç½®ä¸è§„èŒƒå®šä¹‰ # ========================================== OUTPUT_DIR = \"generated\" # ç±»å‹æ˜ å°„è¡¨ (Spec 7.1) TYPE_MAPPING = { \"int\": (\"int\", \"int32_t\"), \"long\": (\"long\", \"int64_t\"), \"string\": (\"String\", \"std::string\"), \"float\": (\"float\", \"float\"), \"bool\": (\"boolean\", \"bool\"), } # è§„èŒƒ 3.2: åç¼€ç™½åå• (åŒ…å«æœ€æ–°çš„ _STAT) VALID_SUFFIXES = { # è‡´å‘½å¼‚å¸¸ \"_CRASH\", \"_ANR\", \"_RESET\", \"_OOM\", \"_KILLED\", \"_BLANK\", # æ€§èƒ½ä½“éªŒ \"_SLOW\", \"_BLOCK\", \"_JANK\", \"_TIMEOUT\", \"_BUSY\", # èµ„æºæ³„æ¼ \"_LEAK\", \"_HIGH\", \"_LOW\", # é“¾è·¯ç®¡æ§ \"_LOST\", \"_REJECT\", \"_FAIL\", # ç»Ÿè®¡ä¸è¶‹åŠ¿ (New) \"_STAT\" } # ç³»ç»Ÿä¿ç•™å­—æ®µ (Common Fields)ï¼Œä¸¥ç¦å‡ºç°åœ¨ Desc_Schema ç”Ÿæˆçš„ä»£ç ä¸­ RESERVED_FIELDS = {\"tid\", \"pid\", \"proc\", \"ver\", \"logf\"} # ========================================== # 2. æ•°æ®æ¨¡å‹ # ========================================== @dataclass class Field: name: str schema_type: str is_optional: bool @property def java_type(self): return TYPE_MAPPING[self.schema_type][0] @property def cpp_type(self): return TYPE_MAPPING[self.schema_type][1] @property def name_capitalized(self): return self.name[0].upper() + self.name[1:] @dataclass class EventContext: event_id: str event_name: str logical_module: str owner: str sdk_type: str sdk_level: str status: str fields: List[Field] @property def class_name(self): # Rule: PascalCase + Context # GVM_APP_ANR -\u003e GvmAppAnrContext parts = self.event_name.split('_') return \"\".join(p.capitalize() for p in parts) + \"Context\" @property def scope(self): # Rule: Extract first part of EventName as Scope # GVM_APP_ANR -\u003e gvm parts = self.event_name.split('_') if not parts: raise ValueError(f\"Invalid EventName format: {self.event_name}\") return parts[0].lower() @property def module_clean(self): # Rule: Logical_Module to lowercase, remove spaces # \"AppManager\" -\u003e \"appmanager\" return self.logical_module.lower().replace(\" \", \"\") @property def package_name(self): # Java Package: com.polaris.events.. return f\"com.polaris.events.{self.scope}.{self.module_clean}\" @property def cpp_namespace(self): # C++ Namespace: polaris::events:::: return f\"polaris::events::{self.scope}::{self.module_clean}\" @property def is_deprecated(self): return self.status.lower() == \"deprecated\" @property def required_fields(self): return [f for f in self.fields if not f.is_optional] @property def optional_fields(self): return [f for f in self.fields if f.is_optional] # ========================================== # 3. æ¨¡æ¿å®šä¹‰ (Jinja2) # ========================================== # Java Template # æ›´æ–°ç‚¹ï¼šä¸ç”Ÿæˆ Common å­—æ®µï¼›æ”¯æŒ setLogRef ç­‰ JAVA_TEMPLATE = \"\"\"package {{ event.package_name }}; import com.polaris.constants.PolarisEvents; import com.polaris.core.BasePolarisContext; import com.polaris.core.PolarisAgent; import org.json.JSONObject; /** * Auto-generated by polaris-codegen. * Event: {{ event.event_name }} ({{ event.event_id }}) * Logic Module: {{ event.logical_module }} * Owner: {{ event.owner }} */ {% if event.is_deprecated %}@Deprecated{% endif %} public class {{ event.class_name }} extends BasePolarisContext { // SDK Metadata private final int sdkType = {{ event.sdk_type }}; private final int sdkLevel = {{ event.sdk_level }}; // Business Fields (Desc_Schema) {% for field in event.fields %} private {{ field.java_type }} {{ field.name }}; {% endfor %} // Constructor (Required Fields Only) public {{ event.class_name }}({% for field in event.required_fields %}{{ field.java_type }} {{ field.name }}{% if not loop.last %}, {% endif %}{% endfor %}) { super(PolarisEvents.{{ event.event_name }}); {% for field in event.required_fields %} this.{{ field.name }} = {{ field.name }}; {% endfor %} } // Setters (Optional Fields) {% for field in event.optional_fields %} public {{ event.class_name }} set{{ field.name_capitalized }}({{ field.java_type }} {{ field.name }}) { this.{{ field.name }} = {{ field.name }}; return this; } {% endfor %} @Override public boolean validate() { {% for field in event.required_fields %} {% if field.schema_type == 'string' %} if (this.{{ field.name }} == null) return false; {% endif %} {% endfor %} return true; } @Override public JSONObject toJson() { JSONObject json = new JSONObject(); // Desc_Schema Fields {% for field in event.fields %} json.put(\"{{ field.name }}\", this.{{ field.name }}); {% endfor %} return json; } // Reporting public void report() { PolarisAgent.getInstance().report(this); } } \"\"\" # C++ Template CPP_TEMPLATE = \"\"\"#pragma once #include #include #include \"polaris/constants/PolarisEvents.h\" #include \"polaris/core/BasePolarisContext.h\" namespace {{ event.cpp_namespace }} { /** * Event: {{ event.event_name }} ({{ event.event_id }}) */ {% if event.is_deprecated %}[[deprecated]]{% endif %} class {{ event.class_name }} : public polaris::core::BasePolarisContext { public: const int32_t sdk_type = {{ event.sdk_type }}; const int32_t sdk_level = {{ event.sdk_level }}; {% for field in event.fields %} {{ field.cpp_type }} {{ field.name }}; {% endfor %} {{ event.class_name }}({% for field in event.required_fields %}{{ field.cpp_type }} {{ field.name }}_in{% if not loop.last %}, {% endif %}{% endfor %}) : BasePolarisContext(polaris::constants::{{ event.event_name }}) { {% for field in event.required_fields %} this-\u003e{{ field.name }} = {{ field.name }}_in; {% endfor %} } {% for field in event.optional_fields %} {{ event.class_name }}\u0026 set{{ field.name_capitalized }}({{ field.cpp_type }} {{ field.name }}_in) { this-\u003e{{ field.name }} = {{ field.name }}_in; return *this; } {% endfor %} nlohmann::json toJson() const override { nlohmann::json j; {% for field in event.fields %} j[\"{{ field.name }}\"] = this-\u003e{{ field.name }}; {% endfor %} return j; } }; } // namespace \"\"\" # Constants Java Template (é˜²æ­¢å†…è”) CONSTANTS_JAVA_TEMPLATE = \"\"\"package com.polaris.constants; /** * Auto-generated Event IDs. * Source of Truth: events.csv * NOTE: IDs are initialized in a static block to prevent Java compiler inlining. */ public final class PolarisEvents { // Definitions {% for event in events %} public static final long {{ event.event_name }}; {% endfor %} // Initialization static { {% for event in events %} {{ event.event_name }} = {{ event.event_id }}L; {% endfor %} } } \"\"\" # Constants C++ Template CONSTANTS_CPP_TEMPLATE = \"\"\"#pragma once #include namespace polaris::constants { {% for event in events %} constexpr int64_t {{ event.event_name }} = {{ event.event_id }}; {% endfor %} } \"\"\" # ========================================== # 4. é€»è¾‘å¤„ç†å‡½æ•° # ========================================== def parse_schema(schema_str: str, event_name: str) -\u003e List[Field]: fields = [] if not schema_str or schema_str.upper() == 'NONE': return fields # æ”¯æŒåˆ†å·æˆ–é€—å·åˆ†éš” \"pid:int; reason:string\" delimiter = ';' if ';' in schema_str else ',' for item in [x.strip() for x in schema_str.split(delimiter)]: if ':' not in item: continue name, raw_type = item.split(':') name = name.strip() # [Defensive] è‡ªåŠ¨è¿‡æ»¤ç³»ç»Ÿä¿ç•™å­—æ®µ if name in RESERVED_FIELDS: print(f\"âš ï¸ Warning: Ignored reserved field '{name}' in {event_name}. It is handled by BaseContext.\") continue is_optional = raw_type.endswith('?') schema_type = raw_type.rstrip('?') if schema_type not in TYPE_MAPPING: raise ValueError(f\"âŒ Type Error in {event_name}: Unsupported type '{schema_type}'\") fields.append(Field(name, schema_type, is_optional)) return fields def validate_event_name_suffix(name: str): valid = False for suffix in VALID_SUFFIXES: if name.endswith(suffix): valid = True break if not valid: raise ValueError(f\"âŒ Naming Violation: '{name}' suffix not in whitelist.\") # ========================================== # 5. ä¸»ç”Ÿæˆæµç¨‹ # ========================================== def generate_code(): print(\"ğŸš€ Starting Polaris Codegen...\") # ç›®å½•æ£€æŸ¥ if not os.path.exists(\"generated\"): os.makedirs(\"generated\") events: List[EventContext] = [] try: with open(\"events.csv\", mode=\"r\", encoding=\"utf-8-sig\") as f: reader = csv.DictReader(f) for row in reader: if not row.get(\"EventID\"): continue eid = row[\"EventID\"] ename = row[\"EventName\"] # æ ¡éªŒ validate_event_name_suffix(ename) # è§£æ Schema (è‡ªåŠ¨å»é™¤ Common å­—æ®µ) fields = parse_schema(row[\"Desc_Schema\"], ename) event = EventContext( event_id=eid, event_name=ename, logical_module=row[\"Logical_Module\"], # e.g. \"AppManager\" owner=row[\"Owner\"], sdk_type=row[\"SDK_Type\"], sdk_level=row[\"SDK_Level\"], status=row[\"Status\"], fields=fields ) events.append(event) except Exception as e: print(f\"âŒ Error: {e}\") sys.exit(1) env = Environment(loader=BaseLoader()) # ç”Ÿæˆ Java/C++ Context ç±» for event in events: # Java Path: generated/java/com/polaris/events/// java_pkg_path = event.package_name.replace('.', '/') java_full_path = os.path.join(OUTPUT_DIR, \"java\", java_pkg_path) os.makedirs(java_full_path, exist_ok=True) with open(os.path.join(java_full_path, f\"{event.class_name}.java\"), \"w\") as f: f.write(env.from_string(JAVA_TEMPLATE).render(event=event)) # C++ Path: generated/cpp/include/polaris/events/// # å¯¹åº” namespace: polaris::events:::: cpp_ns_path = os.path.join(\"polaris\", \"events\", event.scope, event.module_clean) cpp_full_path = os.path.join(OUTPUT_DIR, \"cpp\", \"include\", cpp_ns_path) os.makedirs(cpp_full_path, exist_ok=True) with open(os.path.join(cpp_full_path, f\"{event.class_name}.h\"), \"w\") as f: f.write(env.from_string(CPP_TEMPLATE).render(event=event)) # ç”Ÿæˆ Constants # Java const_java_path = os.path.join(OUTPUT_DIR, \"java\", \"com\", \"polaris\", \"constants\") os.makedirs(const_java_path, exist_ok=True) with open(os.path.join(const_java_path, \"PolarisEvents.java\"), \"w\") as f: f.write(env.from_string(CONSTANTS_JAVA_TEMPLATE).render(events=events)) # C++ const_cpp_path = os.path.join(OUTPUT_DIR, \"cpp\", \"include\", \"polaris\", \"constants\") os.makedirs(const_cpp_path, exist_ok=True) with open(os.path.join(const_cpp_path, \"PolarisEvents.h\"), \"w\") as f: f.write(env.from_string(CONSTANTS_CPP_TEMPLATE).render(events=events)) print(f\"âœ… Generated {len(events)} events.\") print(f\"ğŸ“‚ Java Root: {os.path.join(OUTPUT_DIR, 'java')}\") print(f\"ğŸ“‚ C++ Root: {os.path.join(OUTPUT_DIR, 'cpp')}\") if __name__ == \"__main__\": generate_code() ","wordCount":"1795","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://ethen-cao.github.io/ethenslab/others/polaris-1.0-%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E8%A7%84%E8%8C%83%E8%A6%81%E6%B1%82/"},"publisher":{"@type":"Organization","name":"Ethen çš„å®éªŒå®¤","logo":{"@type":"ImageObject","url":"https://ethen-cao.github.io/ethenslab/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ethen-cao.github.io/ethenslab/ accesskey=h title="Ethen çš„å®éªŒå®¤ (Alt + H)">Ethen çš„å®éªŒå®¤</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ethen-cao.github.io/ethenslab/android-dev/ title=Androidç³»ç»Ÿå¼€å‘><span>Androidç³»ç»Ÿå¼€å‘</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/android-automotive-os-dev/ title="Android Automotive"><span>Android Automotive</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/qnx/ title=QNXå¼€å‘><span>QNXå¼€å‘</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/gunyah/ title=Gunyah><span>Gunyah</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/ivi-solution/ title=æ™ºèƒ½åº§èˆ±æ–¹æ¡ˆ><span>æ™ºèƒ½åº§èˆ±æ–¹æ¡ˆ</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/explore-ai title="Explore AI"><span>Explore AI</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ethen-cao.github.io/ethenslab/>Home</a>&nbsp;Â»&nbsp;<a href=https://ethen-cao.github.io/ethenslab/others/>æ‚è®°</a></div><h1 class="post-title entry-hint-parent"></h1><div class=post-meta>9 min&nbsp;Â·&nbsp;1795 words</div></header><div class=post-content><h1 id=polaris-10-è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒè¦æ±‚>Polaris 1.0 è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒè¦æ±‚<a hidden class=anchor aria-hidden=true href=#polaris-10-è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒè¦æ±‚>#</a></h1><p><strong>Polaris Code Generation Specification</strong></p><table><thead><tr><th>ç‰ˆæœ¬</th><th>æ—¥æœŸ</th><th>ä½œè€…</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>v1.0</td><td>2025-12-XX</td><td>Polaris Team</td><td>åˆå§‹ç‰ˆæœ¬</td></tr></tbody></table><hr><h2 id=1-ç›®æ ‡ä¸åŸåˆ™goals--principles>1. ç›®æ ‡ä¸åŸåˆ™ï¼ˆGoals & Principlesï¼‰<a hidden class=anchor aria-hidden=true href=#1-ç›®æ ‡ä¸åŸåˆ™goals--principles>#</a></h2><h3 id=11-ç›®æ ‡>1.1 ç›®æ ‡<a hidden class=anchor aria-hidden=true href=#11-ç›®æ ‡>#</a></h3><p>è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆï¼ˆCodegenï¼‰ç”¨äºå°† <strong>å…¨å±€äº‹ä»¶æ³¨å†Œè¡¨</strong> è½¬æ¢ä¸ºï¼š</p><ul><li>å¼ºç±»å‹ã€å¯ç¼–è¯‘æ ¡éªŒçš„ SDK ä»£ç </li><li>è·¨è¯­è¨€ä¸€è‡´ï¼ˆJava / C++ï¼‰</li><li>å¯è¢« IDE ç²¾å‡†æç¤º</li><li>åœ¨å¤§è§„æ¨¡äº‹ä»¶æ•°é‡ä¸‹ä¾ç„¶å¯ç»´æŠ¤</li></ul><h3 id=12-æ ¸å¿ƒè®¾è®¡åŸåˆ™å¼ºåˆ¶>1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼ˆå¼ºåˆ¶ï¼‰<a hidden class=anchor aria-hidden=true href=#12-æ ¸å¿ƒè®¾è®¡åŸåˆ™å¼ºåˆ¶>#</a></h3><table><thead><tr><th>åŸåˆ™</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç±»å‹å®‰å…¨ä¼˜å…ˆ</strong></td><td>ä»»ä½•å‚æ•°é”™è¯¯å¿…é¡»åœ¨<strong>ç¼–è¯‘æœŸæˆ–æ„é€ æœŸ</strong>æš´éœ²</td></tr><tr><td><strong>å»ä¸­å¿ƒåŒ–</strong></td><td>ç¦æ­¢ç”Ÿæˆé›†ä¸­å¼ God Classï¼ˆå¦‚ Reporter èšåˆç±»ï¼‰</td></tr><tr><td><strong>ä¸€äº‹ä»¶ä¸€ç±»å‹</strong></td><td>æ¯ä¸ª Event å¿…é¡»ç”Ÿæˆç‹¬ç«‹çš„ Context ç±»</td></tr><tr><td><strong>æ„é€ å³åˆæ³•</strong></td><td>æ„é€ å‡½æ•°å¿…é¡»ä¿è¯å¿…å¡«å­—æ®µå®Œæ•´;å¯é€‰å­—æ®µæä¾›setteræ–¹æ³•</td></tr><tr><td><strong>ç”Ÿæˆä»£ç å¯åˆ å¯è£å‰ª</strong></td><td>æœªä½¿ç”¨äº‹ä»¶å…è®¸è¢« R8 / Linker ç§»é™¤</td></tr><tr><td><strong>Core ç¨³å®šï¼ŒGenerated æ˜“å˜</strong></td><td>Core SDK ä¸å› æ–°å¢äº‹ä»¶è€Œå˜åŒ–</td></tr></tbody></table><hr><h2 id=2-è¾“å…¥æºè§„èŒƒsource-of-truth>2. è¾“å…¥æºè§„èŒƒï¼ˆSource of Truthï¼‰<a hidden class=anchor aria-hidden=true href=#2-è¾“å…¥æºè§„èŒƒsource-of-truth>#</a></h2><h3 id=21-å”¯ä¸€è¾“å…¥æº>2.1 å”¯ä¸€è¾“å…¥æº<a hidden class=anchor aria-hidden=true href=#21-å”¯ä¸€è¾“å…¥æº>#</a></h3><p>è‡ªåŠ¨åŒ–ç”Ÿæˆçš„<strong>å”¯ä¸€å¯ä¿¡è¾“å…¥æº</strong>ä¸ºï¼š</p><ul><li><code>events.csv</code> / <code>events.xlsx</code>ï¼ˆæ³¨å†Œè¡¨ï¼‰</li><li>ç¦æ­¢ä»ä»£ç åå‘ç”Ÿæˆæˆ–æ‰‹åŠ¨è¡¥ä¸</li></ul><h3 id=22-å…³é”®å­—æ®µæ˜ å°„å…³ç³»>2.2 å…³é”®å­—æ®µæ˜ å°„å…³ç³»<a hidden class=anchor aria-hidden=true href=#22-å…³é”®å­—æ®µæ˜ å°„å…³ç³»>#</a></h3><table><thead><tr><th>æ³¨å†Œè¡¨å­—æ®µ</th><th>ç”Ÿæˆä»£ç ä¸­çš„ç”¨é€”</th></tr></thead><tbody><tr><td>EventID</td><td>Context æ„é€ å‡½æ•°ä¸­ç»‘å®š</td></tr><tr><td>EventName</td><td>ç±»å / å¸¸é‡å</td></tr><tr><td>Desc_Schema</td><td>å­—æ®µå®šä¹‰ã€æ„é€ å‡½æ•°å‚æ•°</td></tr><tr><td>Status</td><td>æ§åˆ¶æ˜¯å¦ç”Ÿæˆ / æ˜¯å¦æ ‡è®° Deprecated</td></tr><tr><td>Logical_Module</td><td>åŒ…å / namespace åˆ†ç»„</td></tr><tr><td>SDK_Type</td><td>å¯¹åº”private final int SDK_TYPE</td></tr><tr><td>SDK_LEVEL</td><td>å¯¹åº”private final int SDK_LEVEL</td></tr></tbody></table><hr><h2 id=3-ç”Ÿæˆç‰©æ€»ä½“ç»“æ„è§„èŒƒ>3. ç”Ÿæˆç‰©æ€»ä½“ç»“æ„è§„èŒƒ<a hidden class=anchor aria-hidden=true href=#3-ç”Ÿæˆç‰©æ€»ä½“ç»“æ„è§„èŒƒ>#</a></h2><h3 id=31-ç¦æ­¢ç”Ÿæˆçš„å†…å®¹-hard-rules>3.1 ç¦æ­¢ç”Ÿæˆçš„å†…å®¹ï¼ˆâŒ Hard Rulesï¼‰<a hidden class=anchor aria-hidden=true href=#31-ç¦æ­¢ç”Ÿæˆçš„å†…å®¹-hard-rules>#</a></h3><p><strong>Codegen è„šæœ¬å¿…é¡»éµå®ˆä»¥ä¸‹ç¦æ­¢é¡¹ï¼š</strong></p><p>âŒ ä¸å¾—ç”Ÿæˆï¼š</p><ul><li><code>PolarisReporter</code> / <code>EventManager</code> ç­‰é›†ä¸­è°ƒåº¦ç±»</li><li><code>report(long id, Object...)</code> / <code>Map&lt;String,Object></code> é£æ ¼ API</li><li>åå°„ã€å­—ç¬¦ä¸²æ‹¼å­—æ®µåçš„é€»è¾‘</li><li>å•æ–‡ä»¶åŒ…å«å¤šä¸ª Event çš„ Context ç±»</li></ul><hr><h3 id=32-å¿…é¡»ç”Ÿæˆçš„å†…å®¹-hard-rules>3.2 å¿…é¡»ç”Ÿæˆçš„å†…å®¹ï¼ˆâœ… Hard Rulesï¼‰<a hidden class=anchor aria-hidden=true href=#32-å¿…é¡»ç”Ÿæˆçš„å†…å®¹-hard-rules>#</a></h3><table><thead><tr><th>ç”Ÿæˆç‰©</th><th>æ˜¯å¦å¿…é¡»</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>PolarisEvents</code></td><td>âœ…</td><td>EventID å¸¸é‡å®šä¹‰</td></tr><tr><td><code>BasePolarisContext</code></td><td>âŒï¼ˆæ‰‹å†™ï¼‰</td><td>ä½äº Core SDK</td></tr><tr><td><code>XxxContext</code></td><td>âœ…</td><td>æ¯ä¸ª Event ä¸€ä¸ª</td></tr><tr><td><code>@Deprecated</code> æ³¨è§£</td><td>âœ…</td><td>Status=Deprecated</td></tr></tbody></table><hr><h4 id=æ ¸å¿ƒè§„åˆ™é€»è¾‘>æ ¸å¿ƒè§„åˆ™é€»è¾‘<a hidden class=anchor aria-hidden=true href=#æ ¸å¿ƒè§„åˆ™é€»è¾‘>#</a></h4><p>Java åŒ…å: com.polaris.events.<scope>.&lt;logical_module>
Scope: å– EventName çš„ç¬¬ä¸€æ®µï¼ˆå¦‚ GVM -> gvmï¼‰ã€‚
Logical_Module: å–æ³¨å†Œè¡¨ Logical_Module åˆ—ï¼Œè½¬å°å†™å¹¶å»ç©ºæ ¼ï¼ˆå¦‚ AppManager -> appmanagerï¼‰ã€‚
C++ ç›®å½•: include/polaris/events/<scope>/&lt;logical_module>/
ä¸ Java åŒ…åé€»è¾‘ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œç¡®ä¿è·¨è¯­è¨€ç»“æ„å¯¹ç§°ã€‚</p><p>ç±»åç”Ÿæˆ: EventName è½¬ PascalCase + Context
GVM_APP_ANR -> GvmAppAnrContext</p><p>é˜²å¾¡æ€§é€»è¾‘:
è‡ªåŠ¨ä» Desc_Schema ä¸­å‰”é™¤ tid, pid, proc, ver, logfï¼Œé˜²æ­¢ä¸åŸºç±» Common å­—æ®µå†²çªã€‚
Java å¸¸é‡ä½¿ç”¨ static {} å—åˆå§‹åŒ–ï¼Œé˜²æ­¢ç¼–è¯‘å™¨å†…è”ã€‚</p><h2 id=4-context-ç±»ç”Ÿæˆè§„èŒƒæ ¸å¿ƒ>4. Context ç±»ç”Ÿæˆè§„èŒƒï¼ˆæ ¸å¿ƒï¼‰<a hidden class=anchor aria-hidden=true href=#4-context-ç±»ç”Ÿæˆè§„èŒƒæ ¸å¿ƒ>#</a></h2><h3 id=41-ç±»å‘½åè§„åˆ™>4.1 ç±»å‘½åè§„åˆ™<a hidden class=anchor aria-hidden=true href=#41-ç±»å‘½åè§„åˆ™>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>&lt;EventName&gt; + &#34;Context&#34;
</span></span></code></pre></div><p>ç¤ºä¾‹ï¼š</p><table><thead><tr><th>EventName</th><th>Context ç±»å</th></tr></thead><tbody><tr><td>SYS_WATCHDOG_RESET</td><td>SysWatchdogResetContext</td></tr><tr><td>APP_MAP_ANR</td><td>AppMapAnrContext</td></tr></tbody></table><hr><h3 id=42-åŒ…--namespace-è§„åˆ™å¼ºåˆ¶>4.2 åŒ… / Namespace è§„åˆ™ï¼ˆå¼ºåˆ¶ï¼‰<a hidden class=anchor aria-hidden=true href=#42-åŒ…--namespace-è§„åˆ™å¼ºåˆ¶>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>com.polaris.events.&lt;logical_module&gt;.&lt;scope&gt;
</span></span></code></pre></div><p>ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>com.polaris.events.framework.sys
</span></span><span style=display:flex><span>com.polaris.events.app.map
</span></span><span style=display:flex><span>com.polaris.events.mcu.power
</span></span></code></pre></div><blockquote><p>ğŸ“Œ Codegen å¿…é¡»æ”¯æŒæœªæ¥ <strong>æ‹†åˆ†ä¸ºç‹¬ç«‹ AAR / jar / so</strong></p></blockquote><hr><h3 id=43-å­—æ®µä¸æ„é€ å‡½æ•°è§„åˆ™å¼ºåˆ¶>4.3 å­—æ®µä¸æ„é€ å‡½æ•°è§„åˆ™ï¼ˆå¼ºåˆ¶ï¼‰<a hidden class=anchor aria-hidden=true href=#43-å­—æ®µä¸æ„é€ å‡½æ•°è§„åˆ™å¼ºåˆ¶>#</a></h3><h4 id=431-å¿…å¡«å­—æ®µrequired>4.3.1 å¿…å¡«å­—æ®µï¼ˆRequiredï¼‰<a hidden class=anchor aria-hidden=true href=#431-å¿…å¡«å­—æ®µrequired>#</a></h4><ul><li>å¿…é¡»ï¼š<ul><li>å‡ºç°åœ¨æ„é€ å‡½æ•°å‚æ•°åˆ—è¡¨</li><li>åœ¨æ„é€ å‡½æ•°å†…èµ‹å€¼</li></ul></li><li>ç¦æ­¢ï¼š<ul><li>æä¾› setter</li><li>æä¾›é»˜è®¤å€¼</li></ul></li><li>Contextç±»å¿…é¡»æä¾›final int SDK_TYPEå’Œfinal int SDK_LEVELå­—æ®µï¼Œå˜é‡å€¼ä»events.csvä¸­æå–ï¼Œå¹¶æä¾›getæ–¹æ³•</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>SysWatchdogResetContext</span>(<span style=color:#66d9ef>int</span> pid, String reason) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(PolarisEvents.<span style=color:#a6e22e>SYS_WATCHDOG_RESET</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pid</span> <span style=color:#f92672>=</span> pid;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>reason</span> <span style=color:#f92672>=</span> reason;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h4 id=432-å¯é€‰å­—æ®µoptional>4.3.2 å¯é€‰å­—æ®µï¼ˆOptionalï¼‰<a hidden class=anchor aria-hidden=true href=#432-å¯é€‰å­—æ®µoptional>#</a></h4><ul><li>ä¸å‡ºç°åœ¨æ„é€ å‡½æ•°ä¸­</li><li>å¿…é¡»é€šè¿‡é“¾å¼ Setter è®¾ç½®</li><li>Setter è¿”å› <code>this</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> AppMapAnrContext <span style=color:#a6e22e>setActivity</span>(String activity) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>activity</span> <span style=color:#f92672>=</span> activity;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h3 id=44-validate-ç”Ÿæˆè§„èŒƒ>4.4 validate() ç”Ÿæˆè§„èŒƒ<a hidden class=anchor aria-hidden=true href=#44-validate-ç”Ÿæˆè§„èŒƒ>#</a></h3><p>Codegen å¿…é¡»ç”Ÿæˆ <code>validate()</code> æ–¹æ³•ï¼Œè‡³å°‘åŒ…å«ï¼š</p><ul><li>Required å­—æ®µéç©º / åˆæ³•æ€§æ ¡éªŒ</li><li>æšä¸¾ / èŒƒå›´æ ¡éªŒï¼ˆå¦‚æœ‰ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>validate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pid <span style=color:#f92672>&gt;</span> 0 <span style=color:#f92672>&amp;&amp;</span> reason <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h3 id=45-report-ä¾¿æ·æ–¹æ³•>4.5 report() ä¾¿æ·æ–¹æ³•<a hidden class=anchor aria-hidden=true href=#45-report-ä¾¿æ·æ–¹æ³•>#</a></h3><p>ç”Ÿæˆç±» <strong>å¿…é¡»åŒ…å«</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>report</span>() {
</span></span><span style=display:flex><span>    PolarisAgent.<span style=color:#a6e22e>getInstance</span>().<span style=color:#a6e22e>report</span>(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>ğŸ“Œ è¯¥æ–¹æ³•ä»…æ˜¯è¯­æ³•ç³–ï¼Œä¸å¾—åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚</p></blockquote><hr><h3 id=46-å®ç°-tojson-ä»¥åŠ-tostring-æ–¹æ³•>4.6 å®ç° toJson() ä»¥åŠ toString() æ–¹æ³•<a hidden class=anchor aria-hidden=true href=#46-å®ç°-tojson-ä»¥åŠ-tostring-æ–¹æ³•>#</a></h3><h2 id=5-deprecated-äº‹ä»¶ç”Ÿæˆè§„åˆ™>5. Deprecated äº‹ä»¶ç”Ÿæˆè§„åˆ™<a hidden class=anchor aria-hidden=true href=#5-deprecated-äº‹ä»¶ç”Ÿæˆè§„åˆ™>#</a></h2><p>å½“æ³¨å†Œè¡¨ä¸­ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Status = Deprecated
</span></span></code></pre></div><p>Codegen å¿…é¡»ï¼š</p><ol><li>ä»ç”Ÿæˆ Context ç±»ï¼ˆä¿è¯å…¼å®¹æ—§ä»£ç ï¼‰</li><li>æ·»åŠ  <code>@Deprecated</code> æ³¨è§£</li><li>Javadoc æ ‡æ˜æ›¿ä»£ EventIDï¼ˆå¦‚æœ‰ï¼‰</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @deprecated Use SYS_WATCHDOG_RESET_V2 instead
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Deprecated</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SysWatchdogResetContext</span> { ... }
</span></span></code></pre></div><hr><h2 id=6-polarisevents-å¸¸é‡ç±»ç”Ÿæˆè§„èŒƒ>6. PolarisEvents å¸¸é‡ç±»ç”Ÿæˆè§„èŒƒ<a hidden class=anchor aria-hidden=true href=#6-polarisevents-å¸¸é‡ç±»ç”Ÿæˆè§„èŒƒ>#</a></h2><h3 id=61-èŒè´£è¾¹ç•Œ>6.1 èŒè´£è¾¹ç•Œ<a hidden class=anchor aria-hidden=true href=#61-èŒè´£è¾¹ç•Œ>#</a></h3><ul><li><strong>åªå…è®¸</strong>åŒ…å« <code>public static final long</code></li><li>ä¸å…è®¸æ–¹æ³•</li><li>ä¸å…è®¸é€»è¾‘</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PolarisEvents</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> SYS_WATCHDOG_RESET <span style=color:#f92672>=</span> 6660000001L;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=7-è·¨è¯­è¨€ä¸€è‡´æ€§è¦æ±‚java--c>7. è·¨è¯­è¨€ä¸€è‡´æ€§è¦æ±‚ï¼ˆJava / C++ï¼‰<a hidden class=anchor aria-hidden=true href=#7-è·¨è¯­è¨€ä¸€è‡´æ€§è¦æ±‚java--c>#</a></h2><h3 id=71-ç”Ÿæˆè§„åˆ™å¿…é¡»ä¸€è‡´>7.1 ç”Ÿæˆè§„åˆ™å¿…é¡»ä¸€è‡´<a hidden class=anchor aria-hidden=true href=#71-ç”Ÿæˆè§„åˆ™å¿…é¡»ä¸€è‡´>#</a></h3><table><thead><tr><th>ç»´åº¦</th><th>Java</th><th>C++</th></tr></thead><tbody><tr><td>ç±»/ç»“æ„ä½“</td><td>class</td><td>struct / class</td></tr><tr><td>æ„é€ å‡½æ•°</td><td>å¼ºåˆ¶ Required</td><td>å¼ºåˆ¶ Required</td></tr><tr><td>Optional</td><td>Setter</td><td>Setter</td></tr><tr><td>validate</td><td>virtual override</td><td>virtual override</td></tr><tr><td>JSON</td><td>JSONObject</td><td>nlohmann::json</td></tr></tbody></table><hr><h2 id=8-ç”Ÿæˆä»£ç è´¨é‡è¦æ±‚>8. ç”Ÿæˆä»£ç è´¨é‡è¦æ±‚<a hidden class=anchor aria-hidden=true href=#8-ç”Ÿæˆä»£ç è´¨é‡è¦æ±‚>#</a></h2><h3 id=81-ç”Ÿæˆä»£ç å¿…é¡»æ»¡è¶³>8.1 ç”Ÿæˆä»£ç å¿…é¡»æ»¡è¶³<a hidden class=anchor aria-hidden=true href=#81-ç”Ÿæˆä»£ç å¿…é¡»æ»¡è¶³>#</a></h3><ul><li>å¯ç›´æ¥é€šè¿‡ <code>javac / clang</code> ç¼–è¯‘</li><li>æ—  warningï¼ˆ-Wallï¼‰</li><li>ä¸ä¾èµ–åå°„</li><li>ä¸ä¾èµ–è¿è¡Œæ—¶ schema</li></ul><hr><h2 id=9-æ¼”è¿›ä¸å…¼å®¹æ€§è¦æ±‚>9. æ¼”è¿›ä¸å…¼å®¹æ€§è¦æ±‚<a hidden class=anchor aria-hidden=true href=#9-æ¼”è¿›ä¸å…¼å®¹æ€§è¦æ±‚>#</a></h2><h3 id=91-schema-å˜æ›´è§„åˆ™>9.1 Schema å˜æ›´è§„åˆ™<a hidden class=anchor aria-hidden=true href=#91-schema-å˜æ›´è§„åˆ™>#</a></h3><table><thead><tr><th>å˜æ›´ç±»å‹</th><th>æ˜¯å¦å…è®¸</th></tr></thead><tbody><tr><td>æ–°å¢ Optional å­—æ®µ</td><td>âŒï¼ˆéœ€æ–° EventIDï¼‰</td></tr><tr><td>ä¿®æ”¹å­—æ®µç±»å‹</td><td>âŒ</td></tr><tr><td>ä¿®æ”¹ Required / Optional</td><td>âŒ</td></tr><tr><td>ä¿®æ”¹ Owner / Desc</td><td>âœ…</td></tr></tbody></table><blockquote><p>ğŸ“Œ <strong>Codegen å¿…é¡»å‡è®¾æ—§ç«¯ä»£ç æ°¸è¿œå­˜åœ¨</strong></p></blockquote><hr><h2 id=10-éç›®æ ‡non-goals>10. éç›®æ ‡ï¼ˆNon-Goalsï¼‰<a hidden class=anchor aria-hidden=true href=#10-éç›®æ ‡non-goals>#</a></h2><p>æœ¬è§„èŒƒ <strong>ä¸è´Ÿè´£</strong>ï¼š</p><ul><li>äº‹ä»¶åˆ†é…æµç¨‹</li><li>æ³¨å†Œè¡¨è¯„å®¡æœºåˆ¶</li><li>äº‘ç«¯è§£æé€»è¾‘</li><li>SDK å‘é€ç­–ç•¥</li></ul><hr><h2 id=11-è®¾è®¡å“²å­¦>11. è®¾è®¡å“²å­¦<a hidden class=anchor aria-hidden=true href=#11-è®¾è®¡å“²å­¦>#</a></h2><blockquote><p><strong>Codegen çš„èŒè´£ä¸æ˜¯â€œçœä»£ç â€ï¼Œ
è€Œæ˜¯æŠŠâ€œé”™è¯¯â€å°½å¯èƒ½æå‰åˆ°ï¼š</strong></p><ul><li>ç¼–è¯‘æœŸ</li><li>æ„é€ æœŸ</li><li>IDE æç¤ºæœŸ</li></ul></blockquote><blockquote><p><strong>å¦‚æœæŸä¸ªé”™è¯¯åªèƒ½åœ¨è¿è¡Œæ—¶å‘ç°ï¼Œ
é‚£å°±æ˜¯ Codegen çš„å¤±è´¥ã€‚</strong></p></blockquote><hr><h2 id=12-ç»“è¯­>12. ç»“è¯­<a hidden class=anchor aria-hidden=true href=#12-ç»“è¯­>#</a></h2><p>è¿™å¥—è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆè§„èŒƒç¡®ä¿ï¼š</p><ul><li>äº‹ä»¶è§„æ¨¡ Ã—1000ï¼Œå¤æ‚åº¦ â‰ˆ Ã—1</li><li>SDK ä½¿ç”¨ä½“éªŒé•¿æœŸç¨³å®š</li><li>å¹³å°ä»£ç ä¸ä¸šåŠ¡äº‹ä»¶å½»åº•è§£è€¦</li></ul><blockquote><p><strong>è¿™æ˜¯ä¸€ä¸ªâ€œä¸ºåå¹´ç»´æŠ¤å‘¨æœŸè€Œè®¾è®¡â€çš„ Codegen è§„èŒƒã€‚</strong></p></blockquote><hr><h2 id=é™„å½•>é™„å½•<a hidden class=anchor aria-hidden=true href=#é™„å½•>#</a></h2><ol><li><p>javaä»£ç ç”Ÿæˆç›®å½•ç»“æ„ï¼Œå¯å‚è€ƒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>generated/
</span></span><span style=display:flex><span> â””â”€â”€ java/
</span></span><span style=display:flex><span>     â””â”€â”€ com/polaris/
</span></span><span style=display:flex><span>         â”œâ”€â”€ constants/
</span></span><span style=display:flex><span>         â”‚   â””â”€â”€ PolarisEvents.java
</span></span><span style=display:flex><span>         â”‚
</span></span><span style=display:flex><span>         â””â”€â”€ events/
</span></span><span style=display:flex><span>             â”œâ”€â”€ sys/
</span></span><span style=display:flex><span>             â”‚   â””â”€â”€ framework/
</span></span><span style=display:flex><span>             â”‚       â”œâ”€â”€ watchdog/
</span></span><span style=display:flex><span>             â”‚       â”‚   â””â”€â”€ SysWatchdogResetContext.java
</span></span><span style=display:flex><span>             â”‚       â””â”€â”€ anr/
</span></span><span style=display:flex><span>             â”‚           â””â”€â”€ SysServiceAnrContext.java
</span></span><span style=display:flex><span>             â”‚
</span></span><span style=display:flex><span>             â”œâ”€â”€ app/
</span></span><span style=display:flex><span>             â”‚   â””â”€â”€ map/
</span></span><span style=display:flex><span>             â”‚       â””â”€â”€ anr/
</span></span><span style=display:flex><span>             â”‚           â””â”€â”€ AppMapAnrContext.java
</span></span><span style=display:flex><span>             â”‚
</span></span><span style=display:flex><span>             â””â”€â”€ mcu/
</span></span><span style=display:flex><span>                 â””â”€â”€ power/
</span></span><span style=display:flex><span>                     â””â”€â”€ battery/
</span></span><span style=display:flex><span>                         â””â”€â”€ McuBatteryLowContext.java
</span></span></code></pre></div></li><li><p>C++ä»£ç ç”Ÿæˆç›®å½•ç»“æ„ï¼Œå¯å‚è€ƒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>generated/
</span></span><span style=display:flex><span> â””â”€â”€ cpp/
</span></span><span style=display:flex><span>     â”œâ”€â”€ include/
</span></span><span style=display:flex><span>     â”‚   â””â”€â”€ polaris/
</span></span><span style=display:flex><span>     â”‚       â”œâ”€â”€ constants/
</span></span><span style=display:flex><span>     â”‚       â”‚   â””â”€â”€ PolarisEvents.h
</span></span><span style=display:flex><span>     â”‚       â”‚
</span></span><span style=display:flex><span>     â”‚       â””â”€â”€ events/
</span></span><span style=display:flex><span>     â”‚           â”œâ”€â”€ sys/
</span></span><span style=display:flex><span>     â”‚           â”‚   â””â”€â”€ framework/
</span></span><span style=display:flex><span>     â”‚           â”‚       â””â”€â”€ watchdog/
</span></span><span style=display:flex><span>     â”‚           â”‚           â””â”€â”€ SysWatchdogResetContext.h
</span></span><span style=display:flex><span>     â”‚           â”‚
</span></span><span style=display:flex><span>     â”‚           â””â”€â”€ app/
</span></span><span style=display:flex><span>     â”‚               â””â”€â”€ map/
</span></span><span style=display:flex><span>     â”‚                   â””â”€â”€ anr/
</span></span><span style=display:flex><span>     â”‚                       â””â”€â”€ AppMapAnrContext.h
</span></span><span style=display:flex><span>     â”‚
</span></span><span style=display:flex><span>     â””â”€â”€ src/
</span></span><span style=display:flex><span>         â””â”€â”€ events/
</span></span><span style=display:flex><span>             â””â”€â”€ ...
</span></span></code></pre></div></li><li><p>å‚è€ƒä»£ç å®ç°ï¼š</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> csv
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> dataclasses <span style=color:#f92672>import</span> dataclass
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List, Set
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> jinja2 <span style=color:#f92672>import</span> Environment, BaseLoader
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. å…¨å±€é…ç½®ä¸è§„èŒƒå®šä¹‰</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>OUTPUT_DIR <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;generated&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç±»å‹æ˜ å°„è¡¨ (Spec 7.1)</span>
</span></span><span style=display:flex><span>TYPE_MAPPING <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;int&#34;</span>:    (<span style=color:#e6db74>&#34;int&#34;</span>, <span style=color:#e6db74>&#34;int32_t&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;long&#34;</span>:   (<span style=color:#e6db74>&#34;long&#34;</span>, <span style=color:#e6db74>&#34;int64_t&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;string&#34;</span>: (<span style=color:#e6db74>&#34;String&#34;</span>, <span style=color:#e6db74>&#34;std::string&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;float&#34;</span>:  (<span style=color:#e6db74>&#34;float&#34;</span>, <span style=color:#e6db74>&#34;float&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;bool&#34;</span>:   (<span style=color:#e6db74>&#34;boolean&#34;</span>, <span style=color:#e6db74>&#34;bool&#34;</span>),
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è§„èŒƒ 3.2: åç¼€ç™½åå• (åŒ…å«æœ€æ–°çš„ _STAT)</span>
</span></span><span style=display:flex><span>VALID_SUFFIXES <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e># è‡´å‘½å¼‚å¸¸</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;_CRASH&#34;</span>, <span style=color:#e6db74>&#34;_ANR&#34;</span>, <span style=color:#e6db74>&#34;_RESET&#34;</span>, <span style=color:#e6db74>&#34;_OOM&#34;</span>, <span style=color:#e6db74>&#34;_KILLED&#34;</span>, <span style=color:#e6db74>&#34;_BLANK&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ€§èƒ½ä½“éªŒ</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;_SLOW&#34;</span>, <span style=color:#e6db74>&#34;_BLOCK&#34;</span>, <span style=color:#e6db74>&#34;_JANK&#34;</span>, <span style=color:#e6db74>&#34;_TIMEOUT&#34;</span>, <span style=color:#e6db74>&#34;_BUSY&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e># èµ„æºæ³„æ¼</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;_LEAK&#34;</span>, <span style=color:#e6db74>&#34;_HIGH&#34;</span>, <span style=color:#e6db74>&#34;_LOW&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e># é“¾è·¯ç®¡æ§</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;_LOST&#34;</span>, <span style=color:#e6db74>&#34;_REJECT&#34;</span>, <span style=color:#e6db74>&#34;_FAIL&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç»Ÿè®¡ä¸è¶‹åŠ¿ (New)</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;_STAT&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿä¿ç•™å­—æ®µ (Common Fields)ï¼Œä¸¥ç¦å‡ºç°åœ¨ Desc_Schema ç”Ÿæˆçš„ä»£ç ä¸­</span>
</span></span><span style=display:flex><span>RESERVED_FIELDS <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;tid&#34;</span>, <span style=color:#e6db74>&#34;pid&#34;</span>, <span style=color:#e6db74>&#34;proc&#34;</span>, <span style=color:#e6db74>&#34;ver&#34;</span>, <span style=color:#e6db74>&#34;logf&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. æ•°æ®æ¨¡å‹</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@dataclass</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Field</span>:
</span></span><span style=display:flex><span>    name: str
</span></span><span style=display:flex><span>    schema_type: str
</span></span><span style=display:flex><span>    is_optional: bool
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>java_type</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> TYPE_MAPPING[self<span style=color:#f92672>.</span>schema_type][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cpp_type</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> TYPE_MAPPING[self<span style=color:#f92672>.</span>schema_type][<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>name_capitalized</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>name[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>upper() <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>name[<span style=color:#ae81ff>1</span>:]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@dataclass</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EventContext</span>:
</span></span><span style=display:flex><span>    event_id: str
</span></span><span style=display:flex><span>    event_name: str
</span></span><span style=display:flex><span>    logical_module: str
</span></span><span style=display:flex><span>    owner: str
</span></span><span style=display:flex><span>    sdk_type: str
</span></span><span style=display:flex><span>    sdk_level: str
</span></span><span style=display:flex><span>    status: str
</span></span><span style=display:flex><span>    fields: List[Field]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>class_name</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Rule: PascalCase + Context</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># GVM_APP_ANR -&gt; GvmAppAnrContext</span>
</span></span><span style=display:flex><span>        parts <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>event_name<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;_&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(p<span style=color:#f92672>.</span>capitalize() <span style=color:#66d9ef>for</span> p <span style=color:#f92672>in</span> parts) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;Context&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>scope</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Rule: Extract first part of EventName as Scope</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># GVM_APP_ANR -&gt; gvm</span>
</span></span><span style=display:flex><span>        parts <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>event_name<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;_&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> parts:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Invalid EventName format: </span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>event_name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> parts[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>lower()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>module_clean</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Rule: Logical_Module to lowercase, remove spaces</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># &#34;AppManager&#34; -&gt; &#34;appmanager&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>logical_module<span style=color:#f92672>.</span>lower()<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34; &#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>package_name</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Java Package: com.polaris.events.&lt;scope&gt;.&lt;logical_module&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;com.polaris.events.</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>scope<span style=color:#e6db74>}</span><span style=color:#e6db74>.</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>module_clean<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cpp_namespace</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># C++ Namespace: polaris::events::&lt;scope&gt;::&lt;logical_module&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;polaris::events::</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>scope<span style=color:#e6db74>}</span><span style=color:#e6db74>::</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>module_clean<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_deprecated</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>status<span style=color:#f92672>.</span>lower() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;deprecated&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>required_fields</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [f <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>fields <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> f<span style=color:#f92672>.</span>is_optional]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>optional_fields</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [f <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>fields <span style=color:#66d9ef>if</span> f<span style=color:#f92672>.</span>is_optional]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. æ¨¡æ¿å®šä¹‰ (Jinja2)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Java Template</span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ›´æ–°ç‚¹ï¼šä¸ç”Ÿæˆ Common å­—æ®µï¼›æ”¯æŒ setLogRef ç­‰</span>
</span></span><span style=display:flex><span>JAVA_TEMPLATE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;package {{ event.package_name }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>import com.polaris.constants.PolarisEvents;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>import com.polaris.core.BasePolarisContext;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>import com.polaris.core.PolarisAgent;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>import org.json.JSONObject;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Auto-generated by polaris-codegen.
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Event: {{ event.event_name }} ({{ event.event_id }})
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Logic Module: {{ event.logical_module }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Owner: {{ event.owner }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{</span><span style=color:#e6db74>% i</span><span style=color:#e6db74>f event.is_deprecated %}@Deprecated{</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndif %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>public class {{ event.class_name }} extends BasePolarisContext {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    // SDK Metadata
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    private final int sdkType = {{ event.sdk_type }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    private final int sdkLevel = {{ event.sdk_level }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    // Business Fields (Desc_Schema)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.fields %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    private {{ field.java_type }} {{ field.name }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    // Constructor (Required Fields Only)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    public {{ event.class_name }}({</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.required_fields %}{{ field.java_type }} {{ field.name }}{</span><span style=color:#e6db74>% i</span><span style=color:#e6db74>f not loop.last %}, {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndif %}{</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        super(PolarisEvents.{{ event.event_name }});
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.required_fields %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        this.{{ field.name }} = {{ field.name }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    // Setters (Optional Fields)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.optional_fields %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    public {{ event.class_name }} set{{ field.name_capitalized }}({{ field.java_type }} {{ field.name }}) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        this.{{ field.name }} = {{ field.name }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        return this;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    @Override
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    public boolean validate() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.required_fields %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% i</span><span style=color:#e6db74>f field.schema_type == &#39;string&#39; %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if (this.{{ field.name }} == null) return false;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndif %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        return true;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    @Override
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    public JSONObject toJson() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        JSONObject json = new JSONObject();
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        // Desc_Schema Fields
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.fields %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        json.put(&#34;{{ field.name }}&#34;, this.{{ field.name }});
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        return json;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    // Reporting
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    public void report() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        PolarisAgent.getInstance().report(this);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># C++ Template</span>
</span></span><span style=display:flex><span>CPP_TEMPLATE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;#pragma once
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &lt;string&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &lt;nlohmann/json.hpp&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &#34;polaris/constants/PolarisEvents.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &#34;polaris/core/BasePolarisContext.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>namespace {{ event.cpp_namespace }} {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Event: {{ event.event_name }} ({{ event.event_id }})
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{</span><span style=color:#e6db74>% i</span><span style=color:#e6db74>f event.is_deprecated %}[[deprecated]]{</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndif %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>class {{ event.class_name }} : public polaris::core::BasePolarisContext {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>public:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    const int32_t sdk_type = {{ event.sdk_type }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    const int32_t sdk_level = {{ event.sdk_level }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.fields %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {{ field.cpp_type }} {{ field.name }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {{ event.class_name }}({</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.required_fields %}{{ field.cpp_type }} {{ field.name }}_in{</span><span style=color:#e6db74>% i</span><span style=color:#e6db74>f not loop.last %}, {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndif %}{</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}) 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        : BasePolarisContext(polaris::constants::{{ event.event_name }}) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.required_fields %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        this-&gt;{{ field.name }} = {{ field.name }}_in;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.optional_fields %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {{ event.class_name }}&amp; set{{ field.name_capitalized }}({{ field.cpp_type }} {{ field.name }}_in) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        this-&gt;{{ field.name }} = {{ field.name }}_in;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        return *this;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    nlohmann::json toJson() const override {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        nlohmann::json j;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or field in event.fields %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        j[&#34;{{ field.name }}&#34;] = this-&gt;{{ field.name }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        return j;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>} // namespace
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Constants Java Template (é˜²æ­¢å†…è”)</span>
</span></span><span style=display:flex><span>CONSTANTS_JAVA_TEMPLATE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;package com.polaris.constants;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Auto-generated Event IDs.
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Source of Truth: events.csv
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * NOTE: IDs are initialized in a static block to prevent Java compiler inlining.
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */
</span></span></span><span style=display:flex><span><span style=color:#e6db74>public final class PolarisEvents {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    // Definitions
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or event in events %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    public static final long {{ event.event_name }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    // Initialization
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    static {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or event in events %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {{ event.event_name }} = {{ event.event_id }}L;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Constants C++ Template</span>
</span></span><span style=display:flex><span>CONSTANTS_CPP_TEMPLATE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;#pragma once
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &lt;cstdint&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>namespace polaris::constants {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% f</span><span style=color:#e6db74>or event in events %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    constexpr int64_t {{ event.event_name }} = {{ event.event_id }};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {</span><span style=color:#e6db74>% e</span><span style=color:#e6db74>ndfor %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4. é€»è¾‘å¤„ç†å‡½æ•°</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parse_schema</span>(schema_str: str, event_name: str) <span style=color:#f92672>-&gt;</span> List[Field]:
</span></span><span style=display:flex><span>    fields <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> schema_str <span style=color:#f92672>or</span> schema_str<span style=color:#f92672>.</span>upper() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;NONE&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> fields
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ”¯æŒåˆ†å·æˆ–é€—å·åˆ†éš” &#34;pid:int; reason:string&#34;</span>
</span></span><span style=display:flex><span>    delimiter <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;;&#39;</span> <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;;&#39;</span> <span style=color:#f92672>in</span> schema_str <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#39;,&#39;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> item <span style=color:#f92672>in</span> [x<span style=color:#f92672>.</span>strip() <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> schema_str<span style=color:#f92672>.</span>split(delimiter)]:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;:&#39;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> item: <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        name, raw_type <span style=color:#f92672>=</span> item<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;:&#39;</span>)
</span></span><span style=display:flex><span>        name <span style=color:#f92672>=</span> name<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># [Defensive] è‡ªåŠ¨è¿‡æ»¤ç³»ç»Ÿä¿ç•™å­—æ®µ</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> name <span style=color:#f92672>in</span> RESERVED_FIELDS:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;âš ï¸ Warning: Ignored reserved field &#39;</span><span style=color:#e6db74>{</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39; in </span><span style=color:#e6db74>{</span>event_name<span style=color:#e6db74>}</span><span style=color:#e6db74>. It is handled by BaseContext.&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        is_optional <span style=color:#f92672>=</span> raw_type<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#39;?&#39;</span>)
</span></span><span style=display:flex><span>        schema_type <span style=color:#f92672>=</span> raw_type<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>&#39;?&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> schema_type <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> TYPE_MAPPING:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;âŒ Type Error in </span><span style=color:#e6db74>{</span>event_name<span style=color:#e6db74>}</span><span style=color:#e6db74>: Unsupported type &#39;</span><span style=color:#e6db74>{</span>schema_type<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        fields<span style=color:#f92672>.</span>append(Field(name, schema_type, is_optional))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> fields
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>validate_event_name_suffix</span>(name: str):
</span></span><span style=display:flex><span>    valid <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> suffix <span style=color:#f92672>in</span> VALID_SUFFIXES:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> name<span style=color:#f92672>.</span>endswith(suffix):
</span></span><span style=display:flex><span>            valid <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> valid:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;âŒ Naming Violation: &#39;</span><span style=color:#e6db74>{</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39; suffix not in whitelist.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 5. ä¸»ç”Ÿæˆæµç¨‹</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ==========================================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_code</span>():
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;ğŸš€ Starting Polaris Codegen...&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç›®å½•æ£€æŸ¥</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#34;generated&#34;</span>):
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>makedirs(<span style=color:#e6db74>&#34;generated&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    events: List[EventContext] <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;events.csv&#34;</span>, mode<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;r&#34;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8-sig&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>            reader <span style=color:#f92672>=</span> csv<span style=color:#f92672>.</span>DictReader(f)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> row <span style=color:#f92672>in</span> reader:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> row<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;EventID&#34;</span>): <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                eid <span style=color:#f92672>=</span> row[<span style=color:#e6db74>&#34;EventID&#34;</span>]
</span></span><span style=display:flex><span>                ename <span style=color:#f92672>=</span> row[<span style=color:#e6db74>&#34;EventName&#34;</span>]
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e># æ ¡éªŒ</span>
</span></span><span style=display:flex><span>                validate_event_name_suffix(ename)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e># è§£æ Schema (è‡ªåŠ¨å»é™¤ Common å­—æ®µ)</span>
</span></span><span style=display:flex><span>                fields <span style=color:#f92672>=</span> parse_schema(row[<span style=color:#e6db74>&#34;Desc_Schema&#34;</span>], ename)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                event <span style=color:#f92672>=</span> EventContext(
</span></span><span style=display:flex><span>                    event_id<span style=color:#f92672>=</span>eid,
</span></span><span style=display:flex><span>                    event_name<span style=color:#f92672>=</span>ename,
</span></span><span style=display:flex><span>                    logical_module<span style=color:#f92672>=</span>row[<span style=color:#e6db74>&#34;Logical_Module&#34;</span>], <span style=color:#75715e># e.g. &#34;AppManager&#34;</span>
</span></span><span style=display:flex><span>                    owner<span style=color:#f92672>=</span>row[<span style=color:#e6db74>&#34;Owner&#34;</span>],
</span></span><span style=display:flex><span>                    sdk_type<span style=color:#f92672>=</span>row[<span style=color:#e6db74>&#34;SDK_Type&#34;</span>],
</span></span><span style=display:flex><span>                    sdk_level<span style=color:#f92672>=</span>row[<span style=color:#e6db74>&#34;SDK_Level&#34;</span>],
</span></span><span style=display:flex><span>                    status<span style=color:#f92672>=</span>row[<span style=color:#e6db74>&#34;Status&#34;</span>],
</span></span><span style=display:flex><span>                    fields<span style=color:#f92672>=</span>fields
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                events<span style=color:#f92672>.</span>append(event)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;âŒ Error: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    env <span style=color:#f92672>=</span> Environment(loader<span style=color:#f92672>=</span>BaseLoader())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç”Ÿæˆ Java/C++ Context ç±»</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> event <span style=color:#f92672>in</span> events:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Java Path: generated/java/com/polaris/events/&lt;scope&gt;/&lt;module&gt;/</span>
</span></span><span style=display:flex><span>        java_pkg_path <span style=color:#f92672>=</span> event<span style=color:#f92672>.</span>package_name<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;.&#39;</span>, <span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>        java_full_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(OUTPUT_DIR, <span style=color:#e6db74>&#34;java&#34;</span>, java_pkg_path)
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>makedirs(java_full_path, exist_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> open(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(java_full_path, <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>event<span style=color:#f92672>.</span>class_name<span style=color:#e6db74>}</span><span style=color:#e6db74>.java&#34;</span>), <span style=color:#e6db74>&#34;w&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(env<span style=color:#f92672>.</span>from_string(JAVA_TEMPLATE)<span style=color:#f92672>.</span>render(event<span style=color:#f92672>=</span>event))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># C++ Path: generated/cpp/include/polaris/events/&lt;scope&gt;/&lt;module&gt;/</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># å¯¹åº” namespace: polaris::events::&lt;scope&gt;::&lt;module&gt;</span>
</span></span><span style=display:flex><span>        cpp_ns_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#34;polaris&#34;</span>, <span style=color:#e6db74>&#34;events&#34;</span>, event<span style=color:#f92672>.</span>scope, event<span style=color:#f92672>.</span>module_clean)
</span></span><span style=display:flex><span>        cpp_full_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(OUTPUT_DIR, <span style=color:#e6db74>&#34;cpp&#34;</span>, <span style=color:#e6db74>&#34;include&#34;</span>, cpp_ns_path)
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>makedirs(cpp_full_path, exist_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> open(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(cpp_full_path, <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>event<span style=color:#f92672>.</span>class_name<span style=color:#e6db74>}</span><span style=color:#e6db74>.h&#34;</span>), <span style=color:#e6db74>&#34;w&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(env<span style=color:#f92672>.</span>from_string(CPP_TEMPLATE)<span style=color:#f92672>.</span>render(event<span style=color:#f92672>=</span>event))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç”Ÿæˆ Constants</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Java</span>
</span></span><span style=display:flex><span>    const_java_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(OUTPUT_DIR, <span style=color:#e6db74>&#34;java&#34;</span>, <span style=color:#e6db74>&#34;com&#34;</span>, <span style=color:#e6db74>&#34;polaris&#34;</span>, <span style=color:#e6db74>&#34;constants&#34;</span>)
</span></span><span style=display:flex><span>    os<span style=color:#f92672>.</span>makedirs(const_java_path, exist_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(const_java_path, <span style=color:#e6db74>&#34;PolarisEvents.java&#34;</span>), <span style=color:#e6db74>&#34;w&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        f<span style=color:#f92672>.</span>write(env<span style=color:#f92672>.</span>from_string(CONSTANTS_JAVA_TEMPLATE)<span style=color:#f92672>.</span>render(events<span style=color:#f92672>=</span>events))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e># C++</span>
</span></span><span style=display:flex><span>    const_cpp_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(OUTPUT_DIR, <span style=color:#e6db74>&#34;cpp&#34;</span>, <span style=color:#e6db74>&#34;include&#34;</span>, <span style=color:#e6db74>&#34;polaris&#34;</span>, <span style=color:#e6db74>&#34;constants&#34;</span>)
</span></span><span style=display:flex><span>    os<span style=color:#f92672>.</span>makedirs(const_cpp_path, exist_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(const_cpp_path, <span style=color:#e6db74>&#34;PolarisEvents.h&#34;</span>), <span style=color:#e6db74>&#34;w&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        f<span style=color:#f92672>.</span>write(env<span style=color:#f92672>.</span>from_string(CONSTANTS_CPP_TEMPLATE)<span style=color:#f92672>.</span>render(events<span style=color:#f92672>=</span>events))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;âœ… Generated </span><span style=color:#e6db74>{</span>len(events)<span style=color:#e6db74>}</span><span style=color:#e6db74> events.&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;ğŸ“‚ Java Root: </span><span style=color:#e6db74>{</span>os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(OUTPUT_DIR, <span style=color:#e6db74>&#39;java&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;ğŸ“‚ C++ Root:  </span><span style=color:#e6db74>{</span>os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(OUTPUT_DIR, <span style=color:#e6db74>&#39;cpp&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    generate_code()
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://ethen-cao.github.io/ethenslab/>Ethen çš„å®éªŒå®¤</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>