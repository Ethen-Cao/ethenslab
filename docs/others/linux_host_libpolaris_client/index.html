<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ethen 的实验室</title><meta name=keywords content><meta name=description content='libpolaris_client 设计
接口定义
polaris_api.h
/*
 * Copyright (C) 2024 Voyah Polaris Project
 *
 * Polaris Event Reporting SDK (C API)
 * Thread-safe, Lazy-initialized, Opaque Handle based design.
 *
 * Semantics (v0.2):
 * - Best-effort, at-most-once delivery.
 * - Caller thread MUST NOT block on IPC.
 * - All APIs return 0 on success, negative errno-style value on failure.
 */

#ifndef POLARIS_API_H
#define POLARIS_API_H

#include <stdint.h>
#include <stdbool.h>

#ifdef __cplusplus
extern "C" {
#endif

// ============================================================================
// 0. 返回值规范 (Return Codes)
// ============================================================================
// 0: success
// <0: failure, errno-style
//
// Recommended common errors:
// -EINVAL   invalid args / invalid handle / invalid state
// -ENOMEM   allocation failure
// -E2BIG    payload too large / key-value too large
// -EAGAIN   queue full -> dropped
// -ECANCELED handle already canceled
// -EALREADY  handle already committed / SDK already deinit
// -ENOTCONN (optional) policy disallows offline caching and not connected
//
// Note: We intentionally do NOT expose internal error strings here.
// Logging is rate-limited inside SDK.

#ifndef POLARIS_OK
#define POLARIS_OK 0
#endif

// ============================================================================
// 1. 类型定义 (Opaque Handle)
// ============================================================================

typedef struct PolarisEventBuilderInternal* PolarisEventHandle;

// ============================================================================
// 2. 事件构建流程 (Builder Pattern)
// ============================================================================

/**
 * [步骤 1] 创建事件构建器
 * - Lazy init: first successful call triggers SDK initialization.
 *
 * @param event_id       事件 ID (必填, >0)
 * @param process_name   逻辑进程名 (可选，NULL 则自动读取 /proc/self/comm)
 * @param process_ver    版本号 (可选，NULL 默认为 "unknown")
 * @param out_handle     [out] 返回 builder handle
 *
 * @return 0 on success; <0 on failure (errno-style)
 */
int polaris_event_create(uint64_t event_id,
                         const char* process_name,
                         const char* process_ver,
                         PolarisEventHandle* out_handle);

/**
 * [步骤 2] 添加 Key-Value 数据
 * - Builder is NOT thread-safe: same handle must not be mutated concurrently.
 * - On error, builder remains valid unless error indicates invalid handle/state.
 *
 * @return 0 on success; <0 on failure
 */
int polaris_event_add_string(PolarisEventHandle handle, const char* key, const char* value);
int polaris_event_add_int(PolarisEventHandle handle, const char* key, int32_t value);
int polaris_event_add_long(PolarisEventHandle handle, const char* key, int64_t value);
int polaris_event_add_double(PolarisEventHandle handle, const char* key, double value);
int polaris_event_add_bool(PolarisEventHandle handle, const char* key, bool value);

/**
 * [步骤 3] 提交发送
 * - Serializes the event and enqueues to AsyncQueue.
 * - After this call (success or failure), SDK will destroy the handle.
 *   Caller must NOT use handle anymore.
 *
 * @param handle    事件句柄
 * @param log_path  (可选) 附件路径（仅透传，不读文件）
 *
 * @return
 *  0        enqueue success
 * -EAGAIN   queue full -> dropped
 * -E2BIG    payload too large -> dropped
 * -EINVAL   invalid handle / invalid state
 * -ENOMEM   allocation failure
 */
int polaris_event_commit(PolarisEventHandle handle, const char* log_path);

/**
 * [可选] 取消发送
 * - Releases the builder without sending.
 *
 * @return
 *  0          success
 * -EINVAL     invalid handle
 * -EALREADY   already committed
 * -ECANCELED  already canceled
 */
int polaris_event_cancel(PolarisEventHandle handle);

// ============================================================================
// 3. 高级接口 (Raw JSON)
// ============================================================================

/**
 * 直接发送原始 JSON
 * - SDK will wrap it into the event schema and enqueue.
 * - Caller thread returns immediately.
 *
 * @param event_id      事件 ID
 * @param process_name  进程名 (可选，NULL 自动)
 * @param process_ver   版本号 (可选)
 * @param json_body     合法 JSON 字符串（UTF-8）
 * @param log_path      (可选) 附件路径
 *
 * @return 0 on success; <0 on failure (see return codes above)
 */
int polaris_report_raw(uint64_t event_id,
                       const char* process_name,
                       const char* process_ver,
                       const char* json_body,
                       const char* log_path);

// ============================================================================
// 4. 生命周期管理 (可选)
// ============================================================================

/**
 * 显式反初始化（幂等）
 *
 * Strategy A (recommended for low-intrusive):
 * - Stop worker thread, drop pending events, return 0.
 *
 * Strategy B (strict):
 * - If pending queue not empty, return -EBUSY unless caller sets "force".
 *
 * v0.2 default: Strategy A.
 *
 * @return 0 on success; <0 on failure
 */
int polaris_deinit(void);

#ifdef __cplusplus
}
#endif

#endif // POLARIS_API_H
'><meta name=author content><link rel=canonical href=https://ethen-cao.github.io/ethenslab/others/linux_host_libpolaris_client/><link crossorigin=anonymous href=/ethenslab/assets/css/stylesheet.a1917769c3c78460b110da6d7905321bb53af4a56f22ba4cc0de824cf4d097ab.css integrity="sha256-oZF3acPHhGCxENpteQUyG7U69KVvIrpMwN6CTPTQl6s=" rel="preload stylesheet" as=style><link rel=icon href=https://ethen-cao.github.io/ethenslab/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ethen-cao.github.io/ethenslab/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ethen-cao.github.io/ethenslab/favicon-32x32.png><link rel=apple-touch-icon href=https://ethen-cao.github.io/ethenslab/apple-touch-icon.png><link rel=mask-icon href=https://ethen-cao.github.io/ethenslab/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ethen-cao.github.io/ethenslab/others/linux_host_libpolaris_client/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://ethen-cao.github.io/ethenslab/others/linux_host_libpolaris_client/"><meta property="og:site_name" content="Ethen 的实验室"><meta property="og:title" content="Ethen 的实验室"><meta property="og:description" content='libpolaris_client 设计 接口定义 polaris_api.h
/* * Copyright (C) 2024 Voyah Polaris Project * * Polaris Event Reporting SDK (C API) * Thread-safe, Lazy-initialized, Opaque Handle based design. * * Semantics (v0.2): * - Best-effort, at-most-once delivery. * - Caller thread MUST NOT block on IPC. * - All APIs return 0 on success, negative errno-style value on failure. */ #ifndef POLARIS_API_H #define POLARIS_API_H #include <stdint.h> #include <stdbool.h> #ifdef __cplusplus extern "C" { #endif // ============================================================================ // 0. 返回值规范 (Return Codes) // ============================================================================ // 0: success // <0: failure, errno-style // // Recommended common errors: // -EINVAL invalid args / invalid handle / invalid state // -ENOMEM allocation failure // -E2BIG payload too large / key-value too large // -EAGAIN queue full -> dropped // -ECANCELED handle already canceled // -EALREADY handle already committed / SDK already deinit // -ENOTCONN (optional) policy disallows offline caching and not connected // // Note: We intentionally do NOT expose internal error strings here. // Logging is rate-limited inside SDK. #ifndef POLARIS_OK #define POLARIS_OK 0 #endif // ============================================================================ // 1. 类型定义 (Opaque Handle) // ============================================================================ typedef struct PolarisEventBuilderInternal* PolarisEventHandle; // ============================================================================ // 2. 事件构建流程 (Builder Pattern) // ============================================================================ /** * [步骤 1] 创建事件构建器 * - Lazy init: first successful call triggers SDK initialization. * * @param event_id 事件 ID (必填, >0) * @param process_name 逻辑进程名 (可选，NULL 则自动读取 /proc/self/comm) * @param process_ver 版本号 (可选，NULL 默认为 "unknown") * @param out_handle [out] 返回 builder handle * * @return 0 on success; <0 on failure (errno-style) */ int polaris_event_create(uint64_t event_id, const char* process_name, const char* process_ver, PolarisEventHandle* out_handle); /** * [步骤 2] 添加 Key-Value 数据 * - Builder is NOT thread-safe: same handle must not be mutated concurrently. * - On error, builder remains valid unless error indicates invalid handle/state. * * @return 0 on success; <0 on failure */ int polaris_event_add_string(PolarisEventHandle handle, const char* key, const char* value); int polaris_event_add_int(PolarisEventHandle handle, const char* key, int32_t value); int polaris_event_add_long(PolarisEventHandle handle, const char* key, int64_t value); int polaris_event_add_double(PolarisEventHandle handle, const char* key, double value); int polaris_event_add_bool(PolarisEventHandle handle, const char* key, bool value); /** * [步骤 3] 提交发送 * - Serializes the event and enqueues to AsyncQueue. * - After this call (success or failure), SDK will destroy the handle. * Caller must NOT use handle anymore. * * @param handle 事件句柄 * @param log_path (可选) 附件路径（仅透传，不读文件） * * @return * 0 enqueue success * -EAGAIN queue full -> dropped * -E2BIG payload too large -> dropped * -EINVAL invalid handle / invalid state * -ENOMEM allocation failure */ int polaris_event_commit(PolarisEventHandle handle, const char* log_path); /** * [可选] 取消发送 * - Releases the builder without sending. * * @return * 0 success * -EINVAL invalid handle * -EALREADY already committed * -ECANCELED already canceled */ int polaris_event_cancel(PolarisEventHandle handle); // ============================================================================ // 3. 高级接口 (Raw JSON) // ============================================================================ /** * 直接发送原始 JSON * - SDK will wrap it into the event schema and enqueue. * - Caller thread returns immediately. * * @param event_id 事件 ID * @param process_name 进程名 (可选，NULL 自动) * @param process_ver 版本号 (可选) * @param json_body 合法 JSON 字符串（UTF-8） * @param log_path (可选) 附件路径 * * @return 0 on success; <0 on failure (see return codes above) */ int polaris_report_raw(uint64_t event_id, const char* process_name, const char* process_ver, const char* json_body, const char* log_path); // ============================================================================ // 4. 生命周期管理 (可选) // ============================================================================ /** * 显式反初始化（幂等） * * Strategy A (recommended for low-intrusive): * - Stop worker thread, drop pending events, return 0. * * Strategy B (strict): * - If pending queue not empty, return -EBUSY unless caller sets "force". * * v0.2 default: Strategy A. * * @return 0 on success; <0 on failure */ int polaris_deinit(void); #ifdef __cplusplus } #endif #endif // POLARIS_API_H '><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="others"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content='libpolaris_client 设计
接口定义
polaris_api.h
/*
 * Copyright (C) 2024 Voyah Polaris Project
 *
 * Polaris Event Reporting SDK (C API)
 * Thread-safe, Lazy-initialized, Opaque Handle based design.
 *
 * Semantics (v0.2):
 * - Best-effort, at-most-once delivery.
 * - Caller thread MUST NOT block on IPC.
 * - All APIs return 0 on success, negative errno-style value on failure.
 */

#ifndef POLARIS_API_H
#define POLARIS_API_H

#include <stdint.h>
#include <stdbool.h>

#ifdef __cplusplus
extern "C" {
#endif

// ============================================================================
// 0. 返回值规范 (Return Codes)
// ============================================================================
// 0: success
// <0: failure, errno-style
//
// Recommended common errors:
// -EINVAL   invalid args / invalid handle / invalid state
// -ENOMEM   allocation failure
// -E2BIG    payload too large / key-value too large
// -EAGAIN   queue full -> dropped
// -ECANCELED handle already canceled
// -EALREADY  handle already committed / SDK already deinit
// -ENOTCONN (optional) policy disallows offline caching and not connected
//
// Note: We intentionally do NOT expose internal error strings here.
// Logging is rate-limited inside SDK.

#ifndef POLARIS_OK
#define POLARIS_OK 0
#endif

// ============================================================================
// 1. 类型定义 (Opaque Handle)
// ============================================================================

typedef struct PolarisEventBuilderInternal* PolarisEventHandle;

// ============================================================================
// 2. 事件构建流程 (Builder Pattern)
// ============================================================================

/**
 * [步骤 1] 创建事件构建器
 * - Lazy init: first successful call triggers SDK initialization.
 *
 * @param event_id       事件 ID (必填, >0)
 * @param process_name   逻辑进程名 (可选，NULL 则自动读取 /proc/self/comm)
 * @param process_ver    版本号 (可选，NULL 默认为 "unknown")
 * @param out_handle     [out] 返回 builder handle
 *
 * @return 0 on success; <0 on failure (errno-style)
 */
int polaris_event_create(uint64_t event_id,
                         const char* process_name,
                         const char* process_ver,
                         PolarisEventHandle* out_handle);

/**
 * [步骤 2] 添加 Key-Value 数据
 * - Builder is NOT thread-safe: same handle must not be mutated concurrently.
 * - On error, builder remains valid unless error indicates invalid handle/state.
 *
 * @return 0 on success; <0 on failure
 */
int polaris_event_add_string(PolarisEventHandle handle, const char* key, const char* value);
int polaris_event_add_int(PolarisEventHandle handle, const char* key, int32_t value);
int polaris_event_add_long(PolarisEventHandle handle, const char* key, int64_t value);
int polaris_event_add_double(PolarisEventHandle handle, const char* key, double value);
int polaris_event_add_bool(PolarisEventHandle handle, const char* key, bool value);

/**
 * [步骤 3] 提交发送
 * - Serializes the event and enqueues to AsyncQueue.
 * - After this call (success or failure), SDK will destroy the handle.
 *   Caller must NOT use handle anymore.
 *
 * @param handle    事件句柄
 * @param log_path  (可选) 附件路径（仅透传，不读文件）
 *
 * @return
 *  0        enqueue success
 * -EAGAIN   queue full -> dropped
 * -E2BIG    payload too large -> dropped
 * -EINVAL   invalid handle / invalid state
 * -ENOMEM   allocation failure
 */
int polaris_event_commit(PolarisEventHandle handle, const char* log_path);

/**
 * [可选] 取消发送
 * - Releases the builder without sending.
 *
 * @return
 *  0          success
 * -EINVAL     invalid handle
 * -EALREADY   already committed
 * -ECANCELED  already canceled
 */
int polaris_event_cancel(PolarisEventHandle handle);

// ============================================================================
// 3. 高级接口 (Raw JSON)
// ============================================================================

/**
 * 直接发送原始 JSON
 * - SDK will wrap it into the event schema and enqueue.
 * - Caller thread returns immediately.
 *
 * @param event_id      事件 ID
 * @param process_name  进程名 (可选，NULL 自动)
 * @param process_ver   版本号 (可选)
 * @param json_body     合法 JSON 字符串（UTF-8）
 * @param log_path      (可选) 附件路径
 *
 * @return 0 on success; <0 on failure (see return codes above)
 */
int polaris_report_raw(uint64_t event_id,
                       const char* process_name,
                       const char* process_ver,
                       const char* json_body,
                       const char* log_path);

// ============================================================================
// 4. 生命周期管理 (可选)
// ============================================================================

/**
 * 显式反初始化（幂等）
 *
 * Strategy A (recommended for low-intrusive):
 * - Stop worker thread, drop pending events, return 0.
 *
 * Strategy B (strict):
 * - If pending queue not empty, return -EBUSY unless caller sets "force".
 *
 * v0.2 default: Strategy A.
 *
 * @return 0 on success; <0 on failure
 */
int polaris_deinit(void);

#ifdef __cplusplus
}
#endif

#endif // POLARIS_API_H
'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"杂记","item":"https://ethen-cao.github.io/ethenslab/others/"},{"@type":"ListItem","position":2,"name":"","item":"https://ethen-cao.github.io/ethenslab/others/linux_host_libpolaris_client/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","name":"","description":"libpolaris_client 设计 接口定义 polaris_api.h\n/* * Copyright (C) 2024 Voyah Polaris Project * * Polaris Event Reporting SDK (C API) * Thread-safe, Lazy-initialized, Opaque Handle based design. * * Semantics (v0.2): * - Best-effort, at-most-once delivery. * - Caller thread MUST NOT block on IPC. * - All APIs return 0 on success, negative errno-style value on failure. */ #ifndef POLARIS_API_H #define POLARIS_API_H #include \u0026lt;stdint.h\u0026gt; #include \u0026lt;stdbool.h\u0026gt; #ifdef __cplusplus extern \u0026#34;C\u0026#34; { #endif // ============================================================================ // 0. 返回值规范 (Return Codes) // ============================================================================ // 0: success // \u0026lt;0: failure, errno-style // // Recommended common errors: // -EINVAL invalid args / invalid handle / invalid state // -ENOMEM allocation failure // -E2BIG payload too large / key-value too large // -EAGAIN queue full -\u0026gt; dropped // -ECANCELED handle already canceled // -EALREADY handle already committed / SDK already deinit // -ENOTCONN (optional) policy disallows offline caching and not connected // // Note: We intentionally do NOT expose internal error strings here. // Logging is rate-limited inside SDK. #ifndef POLARIS_OK #define POLARIS_OK 0 #endif // ============================================================================ // 1. 类型定义 (Opaque Handle) // ============================================================================ typedef struct PolarisEventBuilderInternal* PolarisEventHandle; // ============================================================================ // 2. 事件构建流程 (Builder Pattern) // ============================================================================ /** * [步骤 1] 创建事件构建器 * - Lazy init: first successful call triggers SDK initialization. * * @param event_id 事件 ID (必填, \u0026gt;0) * @param process_name 逻辑进程名 (可选，NULL 则自动读取 /proc/self/comm) * @param process_ver 版本号 (可选，NULL 默认为 \u0026#34;unknown\u0026#34;) * @param out_handle [out] 返回 builder handle * * @return 0 on success; \u0026lt;0 on failure (errno-style) */ int polaris_event_create(uint64_t event_id, const char* process_name, const char* process_ver, PolarisEventHandle* out_handle); /** * [步骤 2] 添加 Key-Value 数据 * - Builder is NOT thread-safe: same handle must not be mutated concurrently. * - On error, builder remains valid unless error indicates invalid handle/state. * * @return 0 on success; \u0026lt;0 on failure */ int polaris_event_add_string(PolarisEventHandle handle, const char* key, const char* value); int polaris_event_add_int(PolarisEventHandle handle, const char* key, int32_t value); int polaris_event_add_long(PolarisEventHandle handle, const char* key, int64_t value); int polaris_event_add_double(PolarisEventHandle handle, const char* key, double value); int polaris_event_add_bool(PolarisEventHandle handle, const char* key, bool value); /** * [步骤 3] 提交发送 * - Serializes the event and enqueues to AsyncQueue. * - After this call (success or failure), SDK will destroy the handle. * Caller must NOT use handle anymore. * * @param handle 事件句柄 * @param log_path (可选) 附件路径（仅透传，不读文件） * * @return * 0 enqueue success * -EAGAIN queue full -\u0026gt; dropped * -E2BIG payload too large -\u0026gt; dropped * -EINVAL invalid handle / invalid state * -ENOMEM allocation failure */ int polaris_event_commit(PolarisEventHandle handle, const char* log_path); /** * [可选] 取消发送 * - Releases the builder without sending. * * @return * 0 success * -EINVAL invalid handle * -EALREADY already committed * -ECANCELED already canceled */ int polaris_event_cancel(PolarisEventHandle handle); // ============================================================================ // 3. 高级接口 (Raw JSON) // ============================================================================ /** * 直接发送原始 JSON * - SDK will wrap it into the event schema and enqueue. * - Caller thread returns immediately. * * @param event_id 事件 ID * @param process_name 进程名 (可选，NULL 自动) * @param process_ver 版本号 (可选) * @param json_body 合法 JSON 字符串（UTF-8） * @param log_path (可选) 附件路径 * * @return 0 on success; \u0026lt;0 on failure (see return codes above) */ int polaris_report_raw(uint64_t event_id, const char* process_name, const char* process_ver, const char* json_body, const char* log_path); // ============================================================================ // 4. 生命周期管理 (可选) // ============================================================================ /** * 显式反初始化（幂等） * * Strategy A (recommended for low-intrusive): * - Stop worker thread, drop pending events, return 0. * * Strategy B (strict): * - If pending queue not empty, return -EBUSY unless caller sets \u0026#34;force\u0026#34;. * * v0.2 default: Strategy A. * * @return 0 on success; \u0026lt;0 on failure */ int polaris_deinit(void); #ifdef __cplusplus } #endif #endif // POLARIS_API_H ","keywords":[],"articleBody":"libpolaris_client 设计 接口定义 polaris_api.h\n/* * Copyright (C) 2024 Voyah Polaris Project * * Polaris Event Reporting SDK (C API) * Thread-safe, Lazy-initialized, Opaque Handle based design. * * Semantics (v0.2): * - Best-effort, at-most-once delivery. * - Caller thread MUST NOT block on IPC. * - All APIs return 0 on success, negative errno-style value on failure. */ #ifndef POLARIS_API_H #define POLARIS_API_H #include #include #ifdef __cplusplus extern \"C\" { #endif // ============================================================================ // 0. 返回值规范 (Return Codes) // ============================================================================ // 0: success // \u003c0: failure, errno-style // // Recommended common errors: // -EINVAL invalid args / invalid handle / invalid state // -ENOMEM allocation failure // -E2BIG payload too large / key-value too large // -EAGAIN queue full -\u003e dropped // -ECANCELED handle already canceled // -EALREADY handle already committed / SDK already deinit // -ENOTCONN (optional) policy disallows offline caching and not connected // // Note: We intentionally do NOT expose internal error strings here. // Logging is rate-limited inside SDK. #ifndef POLARIS_OK #define POLARIS_OK 0 #endif // ============================================================================ // 1. 类型定义 (Opaque Handle) // ============================================================================ typedef struct PolarisEventBuilderInternal* PolarisEventHandle; // ============================================================================ // 2. 事件构建流程 (Builder Pattern) // ============================================================================ /** * [步骤 1] 创建事件构建器 * - Lazy init: first successful call triggers SDK initialization. * * @param event_id 事件 ID (必填, \u003e0) * @param process_name 逻辑进程名 (可选，NULL 则自动读取 /proc/self/comm) * @param process_ver 版本号 (可选，NULL 默认为 \"unknown\") * @param out_handle [out] 返回 builder handle * * @return 0 on success; \u003c0 on failure (errno-style) */ int polaris_event_create(uint64_t event_id, const char* process_name, const char* process_ver, PolarisEventHandle* out_handle); /** * [步骤 2] 添加 Key-Value 数据 * - Builder is NOT thread-safe: same handle must not be mutated concurrently. * - On error, builder remains valid unless error indicates invalid handle/state. * * @return 0 on success; \u003c0 on failure */ int polaris_event_add_string(PolarisEventHandle handle, const char* key, const char* value); int polaris_event_add_int(PolarisEventHandle handle, const char* key, int32_t value); int polaris_event_add_long(PolarisEventHandle handle, const char* key, int64_t value); int polaris_event_add_double(PolarisEventHandle handle, const char* key, double value); int polaris_event_add_bool(PolarisEventHandle handle, const char* key, bool value); /** * [步骤 3] 提交发送 * - Serializes the event and enqueues to AsyncQueue. * - After this call (success or failure), SDK will destroy the handle. * Caller must NOT use handle anymore. * * @param handle 事件句柄 * @param log_path (可选) 附件路径（仅透传，不读文件） * * @return * 0 enqueue success * -EAGAIN queue full -\u003e dropped * -E2BIG payload too large -\u003e dropped * -EINVAL invalid handle / invalid state * -ENOMEM allocation failure */ int polaris_event_commit(PolarisEventHandle handle, const char* log_path); /** * [可选] 取消发送 * - Releases the builder without sending. * * @return * 0 success * -EINVAL invalid handle * -EALREADY already committed * -ECANCELED already canceled */ int polaris_event_cancel(PolarisEventHandle handle); // ============================================================================ // 3. 高级接口 (Raw JSON) // ============================================================================ /** * 直接发送原始 JSON * - SDK will wrap it into the event schema and enqueue. * - Caller thread returns immediately. * * @param event_id 事件 ID * @param process_name 进程名 (可选，NULL 自动) * @param process_ver 版本号 (可选) * @param json_body 合法 JSON 字符串（UTF-8） * @param log_path (可选) 附件路径 * * @return 0 on success; \u003c0 on failure (see return codes above) */ int polaris_report_raw(uint64_t event_id, const char* process_name, const char* process_ver, const char* json_body, const char* log_path); // ============================================================================ // 4. 生命周期管理 (可选) // ============================================================================ /** * 显式反初始化（幂等） * * Strategy A (recommended for low-intrusive): * - Stop worker thread, drop pending events, return 0. * * Strategy B (strict): * - If pending queue not empty, return -EBUSY unless caller sets \"force\". * * v0.2 default: Strategy A. * * @return 0 on success; \u003c0 on failure */ int polaris_deinit(void); #ifdef __cplusplus } #endif #endif // POLARIS_API_H ","wordCount":"616","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://ethen-cao.github.io/ethenslab/others/linux_host_libpolaris_client/"},"publisher":{"@type":"Organization","name":"Ethen 的实验室","logo":{"@type":"ImageObject","url":"https://ethen-cao.github.io/ethenslab/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ethen-cao.github.io/ethenslab/ accesskey=h title="Ethen 的实验室 (Alt + H)">Ethen 的实验室</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ethen-cao.github.io/ethenslab/android-dev/ title=Android系统开发><span>Android系统开发</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/android-automotive-os-dev/ title="Android Automotive"><span>Android Automotive</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/qnx/ title=QNX开发><span>QNX开发</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/gunyah/ title=Gunyah><span>Gunyah</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/ivi-solution/ title=智能座舱方案><span>智能座舱方案</span></a></li><li><a href=https://ethen-cao.github.io/ethenslab/explore-ai title="Explore AI"><span>Explore AI</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ethen-cao.github.io/ethenslab/>Home</a>&nbsp;»&nbsp;<a href=https://ethen-cao.github.io/ethenslab/others/>杂记</a></div><h1 class="post-title entry-hint-parent"></h1><div class=post-meta>3 min&nbsp;·&nbsp;616 words</div></header><div class=post-content><h2 id=libpolaris_client-设计>libpolaris_client 设计<a hidden class=anchor aria-hidden=true href=#libpolaris_client-设计>#</a></h2><h3 id=接口定义>接口定义<a hidden class=anchor aria-hidden=true href=#接口定义>#</a></h3><p>polaris_api.h</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Copyright (C) 2024 Voyah Polaris Project
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Polaris Event Reporting SDK (C API)
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Thread-safe, Lazy-initialized, Opaque Handle based design.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Semantics (v0.2):
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - Best-effort, at-most-once delivery.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - Caller thread MUST NOT block on IPC.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - All APIs return 0 on success, negative errno-style value on failure.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifndef POLARIS_API_H
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define POLARIS_API_H
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdint.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdbool.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef __cplusplus
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>extern</span> <span style=color:#e6db74>&#34;C&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 0. 返回值规范 (Return Codes)
</span></span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 0: success
</span></span></span><span style=display:flex><span><span style=color:#75715e>// &lt;0: failure, errno-style
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Recommended common errors:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -EINVAL   invalid args / invalid handle / invalid state
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -ENOMEM   allocation failure
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -E2BIG    payload too large / key-value too large
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -EAGAIN   queue full -&gt; dropped
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -ECANCELED handle already canceled
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -EALREADY  handle already committed / SDK already deinit
</span></span></span><span style=display:flex><span><span style=color:#75715e>// -ENOTCONN (optional) policy disallows offline caching and not connected
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Note: We intentionally do NOT expose internal error strings here.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Logging is rate-limited inside SDK.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifndef POLARIS_OK
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define POLARIS_OK 0
</span></span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 1. 类型定义 (Opaque Handle)
</span></span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>PolarisEventBuilderInternal</span><span style=color:#f92672>*</span> PolarisEventHandle;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 2. 事件构建流程 (Builder Pattern)
</span></span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * [步骤 1] 创建事件构建器
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - Lazy init: first successful call triggers SDK initialization.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param event_id       事件 ID (必填, &gt;0)
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param process_name   逻辑进程名 (可选，NULL 则自动读取 /proc/self/comm)
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param process_ver    版本号 (可选，NULL 默认为 &#34;unknown&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param out_handle     [out] 返回 builder handle
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 0 on success; &lt;0 on failure (errno-style)
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_event_create</span>(<span style=color:#66d9ef>uint64_t</span> event_id,
</span></span><span style=display:flex><span>                         <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> process_name,
</span></span><span style=display:flex><span>                         <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> process_ver,
</span></span><span style=display:flex><span>                         PolarisEventHandle<span style=color:#f92672>*</span> out_handle);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * [步骤 2] 添加 Key-Value 数据
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - Builder is NOT thread-safe: same handle must not be mutated concurrently.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - On error, builder remains valid unless error indicates invalid handle/state.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 0 on success; &lt;0 on failure
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_event_add_string</span>(PolarisEventHandle handle, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> key, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> value);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_event_add_int</span>(PolarisEventHandle handle, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> key, <span style=color:#66d9ef>int32_t</span> value);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_event_add_long</span>(PolarisEventHandle handle, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> key, <span style=color:#66d9ef>int64_t</span> value);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_event_add_double</span>(PolarisEventHandle handle, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> key, <span style=color:#66d9ef>double</span> value);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_event_add_bool</span>(PolarisEventHandle handle, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> key, <span style=color:#66d9ef>bool</span> value);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * [步骤 3] 提交发送
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - Serializes the event and enqueues to AsyncQueue.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - After this call (success or failure), SDK will destroy the handle.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   Caller must NOT use handle anymore.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param handle    事件句柄
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param log_path  (可选) 附件路径（仅透传，不读文件）
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  0        enqueue success
</span></span></span><span style=display:flex><span><span style=color:#75715e> * -EAGAIN   queue full -&gt; dropped
</span></span></span><span style=display:flex><span><span style=color:#75715e> * -E2BIG    payload too large -&gt; dropped
</span></span></span><span style=display:flex><span><span style=color:#75715e> * -EINVAL   invalid handle / invalid state
</span></span></span><span style=display:flex><span><span style=color:#75715e> * -ENOMEM   allocation failure
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_event_commit</span>(PolarisEventHandle handle, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> log_path);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * [可选] 取消发送
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - Releases the builder without sending.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  0          success
</span></span></span><span style=display:flex><span><span style=color:#75715e> * -EINVAL     invalid handle
</span></span></span><span style=display:flex><span><span style=color:#75715e> * -EALREADY   already committed
</span></span></span><span style=display:flex><span><span style=color:#75715e> * -ECANCELED  already canceled
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_event_cancel</span>(PolarisEventHandle handle);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 3. 高级接口 (Raw JSON)
</span></span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 直接发送原始 JSON
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - SDK will wrap it into the event schema and enqueue.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - Caller thread returns immediately.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param event_id      事件 ID
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param process_name  进程名 (可选，NULL 自动)
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param process_ver   版本号 (可选)
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param json_body     合法 JSON 字符串（UTF-8）
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param log_path      (可选) 附件路径
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 0 on success; &lt;0 on failure (see return codes above)
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_report_raw</span>(<span style=color:#66d9ef>uint64_t</span> event_id,
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> process_name,
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> process_ver,
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> json_body,
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> log_path);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 4. 生命周期管理 (可选)
</span></span></span><span style=display:flex><span><span style=color:#75715e>// ============================================================================
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 显式反初始化（幂等）
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Strategy A (recommended for low-intrusive):
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - Stop worker thread, drop pending events, return 0.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Strategy B (strict):
</span></span></span><span style=display:flex><span><span style=color:#75715e> * - If pending queue not empty, return -EBUSY unless caller sets &#34;force&#34;.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * v0.2 default: Strategy A.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 0 on success; &lt;0 on failure
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>polaris_deinit</span>(<span style=color:#66d9ef>void</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef __cplusplus
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#endif </span><span style=color:#75715e>// POLARIS_API_H
</span></span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://ethen-cao.github.io/ethenslab/>Ethen 的实验室</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0,theme:"default"})</script><script src=https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js></script><script>(function(){const e=document.querySelectorAll("pre > code.language-plantuml, pre > code.language-planuml");e.forEach(e=>{const s=e.innerText,o=plantumlEncoder.encode(s),i="https://www.plantuml.com/plantuml/svg/"+o,t=document.createElement("img");t.src=i,t.alt="PlantUML Diagram",t.style.maxWidth="100%";const n=e.parentNode;n.parentNode.replaceChild(t,n)})})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>