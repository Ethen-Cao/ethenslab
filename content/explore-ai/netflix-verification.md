+++
date = '2025-08-27T17:17:50+08:00'
draft = false
title = 'Netflix DRM 流程与白名单验证'
+++

![](/ethenslab/images/netflix-verification.png)

1.  **用户操作**：用户在浏览器中打开 Netflix 并点击播放。
2.  **请求清单**：浏览器向 Netflix 服务器请求视频的元数据（Manifest 文件，如 MPD）。
3.  **获取初始化数据**：Netflix 服务器返回 Manifest 文件，其中包含了视频的加密信息和初始化数据（PSSH）。
4.  **生成许可证请求**：
      * 浏览器通过 EME API 将 PSSH 数据传递给 CDM。
      * CDM 根据这些数据生成一个加密的“许可证请求 (License Request)”。
      * 此时，浏览器已经可以查询到 CDM 的安全级别是 L1 还是 L3。
5.  **发送请求至服务器**：浏览器将这个“许可证请求”连同自身的 User-Agent 等信息，一起发送给 Netflix 的许可证服务器。
6.  **服务器端核心验证**：**这是白名单验证发生的地方**。Netflix 服务器会对收到的所有信息进行严格校验：
      * **设备信息**：浏览器类型、版本，操作系统，CDM 模块版本是否在允许的组合（白名单）内？
      * **安全级别**：CDM 是否为 L1（硬件级解密，可播放高清）？
      * **账户状态**：用户账户是否有效？订阅套餐是否支持高清/4K？地理位置是否在服务区内？
7.  **下发许可证**：
      * **验证通过**：如果一切符合要求，服务器会生成一个包含解密密钥的“许可证 (License)”，并将其发送回浏览器。
      * **验证失败或降级**：如果设备不在白名单，或者 CDM 仅为 L3，服务器可能会只发放一个允许播放标清 (SD) 内容的许可证，或者直接拒绝请求。
8.  **解密与播放**：
      * 浏览器通过 EME API 将收到的“许可证”交给 CDM。
      * 对于 L1 级别，CDM 会在硬件安全区（TEE - Trusted Execution Environment）内处理许可证，获取内容密钥，并解密视频流。
      * 解密后的视频帧被安全地渲染到屏幕上。