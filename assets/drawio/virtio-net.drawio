<mxfile host="Electron" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.0.3 Chrome/140.0.7339.249 Electron/38.7.0 Safari/537.36" version="29.0.3">
  <diagram name="第 1 页" id="m8_m7oCuV4uqkMZ3Ozhb">
    <mxGraphModel dx="1169" dy="851" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-27" value="IVI" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1;align=left;verticalAlign=top;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="240" y="110" width="510" height="410" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-1" value="Android guest" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=center;fontStyle=1;labelBackgroundColor=none;fillColor=#99FF99;" vertex="1" parent="1">
          <mxGeometry x="560" y="120" width="181" height="320" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-2" value="QNX Host" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=1;align=center;verticalAlign=top;fillColor=#9999FF;" vertex="1" parent="1">
          <mxGeometry x="250" y="180" width="280" height="240" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-3" value="Hypervisor" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=1;align=left;verticalAlign=top;fillColor=#009900;fontColor=#000000;strokeColor=light-dark(#050505, #ff9164);" vertex="1" parent="1">
          <mxGeometry x="250" y="460" width="490" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-4" target="PqC3kcQHYlqTRFrbp0Qv-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-4" value="Android App" style="rounded=1;whiteSpace=wrap;html=1;fillColor=light-dark(rgba(0, 0, 0, 0), #281d00);strokeColor=light-dark(#0a0a0a, #6d5100);" vertex="1" parent="1">
          <mxGeometry x="591" y="150" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-5" target="PqC3kcQHYlqTRFrbp0Qv-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-5" value="Java网络库" style="rounded=1;whiteSpace=wrap;html=1;fillColor=light-dark(rgba(0, 0, 0, 0), #281d00);strokeColor=light-dark(#0a0a0a, #6d5100);align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=12;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="591" y="210" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-7" target="PqC3kcQHYlqTRFrbp0Qv-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-7" value="libc" style="rounded=1;whiteSpace=wrap;html=1;fillColor=light-dark(rgba(0, 0, 0, 0), #281d00);strokeColor=light-dark(#0a0a0a, #6d5100);align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=12;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="591" y="260" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-9" target="PqC3kcQHYlqTRFrbp0Qv-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-9" value="linux 网络协议栈" style="rounded=1;whiteSpace=wrap;html=1;fillColor=light-dark(rgba(0, 0, 0, 0), #281d00);strokeColor=light-dark(#0a0a0a, #6d5100);align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=12;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="591" y="314" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-33" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-11" target="PqC3kcQHYlqTRFrbp0Qv-30">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="540" y="395" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-11" value="virtio-net驱动" style="rounded=1;whiteSpace=wrap;html=1;fillColor=light-dark(rgba(0, 0, 0, 0), #281d00);strokeColor=light-dark(#0a0a0a, #6d5100);align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=12;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="591" y="380" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.25;entryY=0;entryDx=0;entryDy=0;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-14" target="PqC3kcQHYlqTRFrbp0Qv-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-14" value="qvm process" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="400" y="240" width="120" height="72" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-15" value="vdev-virtio-net" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="415" y="267" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" target="PqC3kcQHYlqTRFrbp0Qv-14">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460" y="460" as="sourcePoint" />
            <mxPoint x="460" y="330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-35" value="vm exit&lt;br&gt;(含访问地址、virtioqueue队列号)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=none;" vertex="1" connectable="0" parent="PqC3kcQHYlqTRFrbp0Qv-18">
          <mxGeometry x="-0.6486" y="2" relative="1" as="geometry">
            <mxPoint x="-48" y="6" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-19" value="io-pkt" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="260" y="240" width="120" height="72" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-20" target="PqC3kcQHYlqTRFrbp0Qv-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-20" value="vdevpeer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="270" y="267" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-15" target="PqC3kcQHYlqTRFrbp0Qv-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-22" target="PqC3kcQHYlqTRFrbp0Qv-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-22" value="bridge / route / VLAN" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="260" y="330" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-24" target="PqC3kcQHYlqTRFrbp0Qv-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-24" value="eth driver" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="260" y="380" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-28" value="T-Box" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1;align=center;verticalAlign=middle;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="30" y="360" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-30" value="virtioqueue&lt;br&gt;（sharememory）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFB366;strokeColor=#B09500;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="490" y="350" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.75;entryY=1;entryDx=0;entryDy=0;curved=1;endArrow=none;endFill=0;dashed=1;dashPattern=8 8;strokeColor=#0000FF;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-36" target="PqC3kcQHYlqTRFrbp0Qv-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-36" value="  Hypervisor 截获 guest 对 loc 等 MMIO 区域的访问：&#xa;  - 触发 guest exit&#xa;  - 携带访问地址/数据" style="text;whiteSpace=wrap;strokeColor=#9673a6;fillColor=#FFFFCC;align=left;verticalAlign=middle;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="530" width="325" height="70" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;strokeColor=#0000FF;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=none;endFill=0;curved=1;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-38" target="PqC3kcQHYlqTRFrbp0Qv-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-38" value="  qvm 在 vCPU 线程里调用“run”接口：&#xa;  - 正常时阻塞在 hypervisor 中&#xa;  - 有 guest exit 时返回&#xa;  - 根据 exit 地址分发到对应 vdev" style="text;whiteSpace=wrap;strokeColor=#9673a6;fillColor=#FFFFCC;align=left;verticalAlign=middle;rounded=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="420" y="10" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-40" value="  vdev-virtio-net 处理流程：&#xa;  1. 根据 queue_id 找到 TX virtqueue&#xa;  2. 扫描 avail ring 找新 desc&#xa;  3. 通过共享地址空间访问 guest buffer&#xa;  4. 用 iov/memcpy 取出以太帧数据&#xa;  5. 交给 vdevpeer / io-pkt" style="text;whiteSpace=wrap;strokeColor=#9673a6;fillColor=#FFFFCC;align=left;verticalAlign=middle;rounded=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="160" y="10" width="240" height="90" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;strokeColor=#0000FF;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=none;endFill=0;curved=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-40" target="PqC3kcQHYlqTRFrbp0Qv-15">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="600" y="110" as="sourcePoint" />
            <mxPoint x="530" y="270" as="targetPoint" />
            <Array as="points">
              <mxPoint x="340" y="170" />
              <mxPoint x="460" y="170" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.818;entryY=0.025;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="PqC3kcQHYlqTRFrbp0Qv-11" target="PqC3kcQHYlqTRFrbp0Qv-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PqC3kcQHYlqTRFrbp0Qv-43" value="kick" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=none;" vertex="1" connectable="0" parent="PqC3kcQHYlqTRFrbp0Qv-42">
          <mxGeometry x="-0.2578" y="-1" relative="1" as="geometry">
            <mxPoint x="20" y="21" as="offset" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
